<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chap4 网络层——数据平面 | lyj Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.0/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css">
    <meta name="description" content="我来到，我看见，我记录">
    
    <link rel="preload" href="/vuepressBlog/assets/css/0.styles.bc106160.css" as="style"><link rel="preload" href="/vuepressBlog/assets/js/app.79827240.js" as="script"><link rel="preload" href="/vuepressBlog/assets/js/2.ab72813d.js" as="script"><link rel="preload" href="/vuepressBlog/assets/js/51.289135c1.js" as="script"><link rel="prefetch" href="/vuepressBlog/assets/js/10.03e6fc0c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/100.e8b6b7b7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/101.cc17f929.js"><link rel="prefetch" href="/vuepressBlog/assets/js/102.ae4e0f0b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/103.d4d26234.js"><link rel="prefetch" href="/vuepressBlog/assets/js/104.5e3f1dd8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/105.9ce2e6e7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/106.72dd2cfb.js"><link rel="prefetch" href="/vuepressBlog/assets/js/107.e8267397.js"><link rel="prefetch" href="/vuepressBlog/assets/js/108.ecddbc63.js"><link rel="prefetch" href="/vuepressBlog/assets/js/109.898b3a1f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/11.97c3d911.js"><link rel="prefetch" href="/vuepressBlog/assets/js/110.8ef9447a.js"><link rel="prefetch" href="/vuepressBlog/assets/js/111.25f3f61a.js"><link rel="prefetch" href="/vuepressBlog/assets/js/112.4829e82e.js"><link rel="prefetch" href="/vuepressBlog/assets/js/113.77145392.js"><link rel="prefetch" href="/vuepressBlog/assets/js/114.1fe8bc4e.js"><link rel="prefetch" href="/vuepressBlog/assets/js/115.3486a85d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/116.7127965d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/117.0119ff19.js"><link rel="prefetch" href="/vuepressBlog/assets/js/118.c12349e8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/119.25870a11.js"><link rel="prefetch" href="/vuepressBlog/assets/js/12.035b5441.js"><link rel="prefetch" href="/vuepressBlog/assets/js/120.4b77b2ec.js"><link rel="prefetch" href="/vuepressBlog/assets/js/121.063fccc3.js"><link rel="prefetch" href="/vuepressBlog/assets/js/122.7360ccc7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/13.a471d1f5.js"><link rel="prefetch" href="/vuepressBlog/assets/js/14.d18ddbd5.js"><link rel="prefetch" href="/vuepressBlog/assets/js/15.e5d08efe.js"><link rel="prefetch" href="/vuepressBlog/assets/js/16.90d343f7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/17.3846f5f9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/18.a519a7e4.js"><link rel="prefetch" href="/vuepressBlog/assets/js/19.54cd345b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/20.2c89b585.js"><link rel="prefetch" href="/vuepressBlog/assets/js/21.ba9d7337.js"><link rel="prefetch" href="/vuepressBlog/assets/js/22.357d0678.js"><link rel="prefetch" href="/vuepressBlog/assets/js/23.dbbaee56.js"><link rel="prefetch" href="/vuepressBlog/assets/js/24.407a2e49.js"><link rel="prefetch" href="/vuepressBlog/assets/js/25.8a8ac0ab.js"><link rel="prefetch" href="/vuepressBlog/assets/js/26.27274d21.js"><link rel="prefetch" href="/vuepressBlog/assets/js/27.2e57c442.js"><link rel="prefetch" href="/vuepressBlog/assets/js/28.740654db.js"><link rel="prefetch" href="/vuepressBlog/assets/js/29.24260f84.js"><link rel="prefetch" href="/vuepressBlog/assets/js/3.479d1f80.js"><link rel="prefetch" href="/vuepressBlog/assets/js/30.c67fc22f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/31.ab6b841e.js"><link rel="prefetch" href="/vuepressBlog/assets/js/32.2dd5a7c0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/33.e4ba0be4.js"><link rel="prefetch" href="/vuepressBlog/assets/js/34.76893a02.js"><link rel="prefetch" href="/vuepressBlog/assets/js/35.637413fd.js"><link rel="prefetch" href="/vuepressBlog/assets/js/36.1ed009ee.js"><link rel="prefetch" href="/vuepressBlog/assets/js/37.6ece5e8f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/38.03242145.js"><link rel="prefetch" href="/vuepressBlog/assets/js/39.c32b36c2.js"><link rel="prefetch" href="/vuepressBlog/assets/js/4.6fcabf8c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/40.1f459569.js"><link rel="prefetch" href="/vuepressBlog/assets/js/41.2c4578bc.js"><link rel="prefetch" href="/vuepressBlog/assets/js/42.f58f077c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/43.9fbdad0d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/44.d62af14f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/45.10d0159d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/46.0f8ba7d7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/47.f7648f0e.js"><link rel="prefetch" href="/vuepressBlog/assets/js/48.004ccfbe.js"><link rel="prefetch" href="/vuepressBlog/assets/js/49.a9c271de.js"><link rel="prefetch" href="/vuepressBlog/assets/js/5.1d5afe99.js"><link rel="prefetch" href="/vuepressBlog/assets/js/50.07b832fc.js"><link rel="prefetch" href="/vuepressBlog/assets/js/52.0222d6cd.js"><link rel="prefetch" href="/vuepressBlog/assets/js/53.3e603f42.js"><link rel="prefetch" href="/vuepressBlog/assets/js/54.c8dcea5c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/55.a0e86f73.js"><link rel="prefetch" href="/vuepressBlog/assets/js/56.5872fd2d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/57.12817bd7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/58.a4edc9cc.js"><link rel="prefetch" href="/vuepressBlog/assets/js/59.94676fad.js"><link rel="prefetch" href="/vuepressBlog/assets/js/6.b0f500a7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/60.92e4fe4b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/61.b5d810ce.js"><link rel="prefetch" href="/vuepressBlog/assets/js/62.0279db96.js"><link rel="prefetch" href="/vuepressBlog/assets/js/63.696e877b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/64.8da2eb5d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/65.b8688b7c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/66.1852821c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/67.756ce4bd.js"><link rel="prefetch" href="/vuepressBlog/assets/js/68.a3ba382f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/69.0884b9ff.js"><link rel="prefetch" href="/vuepressBlog/assets/js/7.0ebb7ad8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/70.d5049e86.js"><link rel="prefetch" href="/vuepressBlog/assets/js/71.092e06e3.js"><link rel="prefetch" href="/vuepressBlog/assets/js/72.73649ab6.js"><link rel="prefetch" href="/vuepressBlog/assets/js/73.e86b5da2.js"><link rel="prefetch" href="/vuepressBlog/assets/js/74.7b94122e.js"><link rel="prefetch" href="/vuepressBlog/assets/js/75.9c4f6c2b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/76.5c2fa362.js"><link rel="prefetch" href="/vuepressBlog/assets/js/77.ecd17b92.js"><link rel="prefetch" href="/vuepressBlog/assets/js/78.0a1f78ce.js"><link rel="prefetch" href="/vuepressBlog/assets/js/79.c79511d2.js"><link rel="prefetch" href="/vuepressBlog/assets/js/8.f2c8fce2.js"><link rel="prefetch" href="/vuepressBlog/assets/js/80.719ff65a.js"><link rel="prefetch" href="/vuepressBlog/assets/js/81.c1585c85.js"><link rel="prefetch" href="/vuepressBlog/assets/js/82.bb0a528a.js"><link rel="prefetch" href="/vuepressBlog/assets/js/83.bae4fb46.js"><link rel="prefetch" href="/vuepressBlog/assets/js/84.d30da75d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/85.a3b44e1b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/86.a7886815.js"><link rel="prefetch" href="/vuepressBlog/assets/js/87.3f155e86.js"><link rel="prefetch" href="/vuepressBlog/assets/js/88.d69a1673.js"><link rel="prefetch" href="/vuepressBlog/assets/js/89.be8d141b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/9.eef82629.js"><link rel="prefetch" href="/vuepressBlog/assets/js/90.994f6ead.js"><link rel="prefetch" href="/vuepressBlog/assets/js/91.1ea1f902.js"><link rel="prefetch" href="/vuepressBlog/assets/js/92.4b13c1bb.js"><link rel="prefetch" href="/vuepressBlog/assets/js/93.77534d34.js"><link rel="prefetch" href="/vuepressBlog/assets/js/94.88c00a03.js"><link rel="prefetch" href="/vuepressBlog/assets/js/95.78874903.js"><link rel="prefetch" href="/vuepressBlog/assets/js/96.06d5caad.js"><link rel="prefetch" href="/vuepressBlog/assets/js/97.cd7e7bb0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/98.5a43026f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/99.5a5125a3.js">
    <link rel="stylesheet" href="/vuepressBlog/assets/css/0.styles.bc106160.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepressBlog/" class="home-link router-link-active"><!----> <span class="site-name">lyj Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepressBlog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TechNote" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="TechNote" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础知识
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/algorithms/" class="nav-link">
  基础算法
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/network/" class="nav-link router-link-active">
  网络原理
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/os/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          算法研究
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/recommendation_system/" class="nav-link">
  推荐系统
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/knowledge_graph/" class="nav-link">
  知识图谱
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/nlp/" class="nav-link">
  自然语言处理
</a></li></ul></li><li class="dropdown-item"><h4>
          工程实践
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/FFmpeg/" class="nav-link">
  FFmpeg
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Python/" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="InvestNote" class="dropdown-title"><span class="title">投资心得</span> <span class="arrow down"></span></button> <button type="button" aria-label="InvestNote" class="mobile-dropdown-title"><span class="title">投资心得</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/economic/" class="nav-link">
  经济
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/chan/" class="nav-link">
  缠论
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/options/" class="nav-link">
  期权
</a></li></ul></div></div><div class="nav-item"><a href="/vuepressBlog/experience/" class="nav-link">
  项目经历
</a></div><div class="nav-item"><a href="/vuepressBlog/resource/" class="nav-link">
  资源聚合
</a></div> <a href="https://github.com/liuyijian/vuepressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepressBlog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TechNote" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="TechNote" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础知识
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/algorithms/" class="nav-link">
  基础算法
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/network/" class="nav-link router-link-active">
  网络原理
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/os/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          算法研究
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/recommendation_system/" class="nav-link">
  推荐系统
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/knowledge_graph/" class="nav-link">
  知识图谱
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/nlp/" class="nav-link">
  自然语言处理
</a></li></ul></li><li class="dropdown-item"><h4>
          工程实践
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/FFmpeg/" class="nav-link">
  FFmpeg
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Python/" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="InvestNote" class="dropdown-title"><span class="title">投资心得</span> <span class="arrow down"></span></button> <button type="button" aria-label="InvestNote" class="mobile-dropdown-title"><span class="title">投资心得</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/economic/" class="nav-link">
  经济
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/chan/" class="nav-link">
  缠论
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/options/" class="nav-link">
  期权
</a></li></ul></div></div><div class="nav-item"><a href="/vuepressBlog/experience/" class="nav-link">
  项目经历
</a></div><div class="nav-item"><a href="/vuepressBlog/resource/" class="nav-link">
  资源聚合
</a></div> <a href="https://github.com/liuyijian/vuepressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>网络原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepressBlog/techNote/basic/network/Chap1.html" class="sidebar-link">Chap1 计算机网络和因特网</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap1.html#_1-1-互联网是什么" class="sidebar-link">1.1 互联网是什么</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap1.html#_1-2-网络边缘" class="sidebar-link">1.2 网络边缘</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap1.html#_1-3-网络核心" class="sidebar-link">1.3 网络核心</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap1.html#_1-4-分组交换网中的时延、丢包和吞吐量" class="sidebar-link">1.4 分组交换网中的时延、丢包和吞吐量</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap1.html#_1-5-协议层次及其服务模型" class="sidebar-link">1.5 协议层次及其服务模型</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap1.html#_1-6-面对攻击的网络" class="sidebar-link">1.6 面对攻击的网络</a></li></ul></li><li><a href="/vuepressBlog/techNote/basic/network/Chap2.html" class="sidebar-link">Chap2 应用层</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap2.html#_2-1-应用层协议原理" class="sidebar-link">2.1 应用层协议原理</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap2.html#_2-2-web和http" class="sidebar-link">2.2 Web和HTTP</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap2.html#_2-3-电子邮件" class="sidebar-link">2.3 电子邮件</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap2.html#_2-4-dns-因特网目录服务" class="sidebar-link">2.4 DNS-因特网目录服务</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap2.html#_2-5-p2p-文件传输" class="sidebar-link">2.5 P2P 文件传输</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap2.html#_2-6-视频流和内容分发网络" class="sidebar-link">2.6 视频流和内容分发网络</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap2.html#_2-7-socket编程" class="sidebar-link">2.7 socket编程</a></li></ul></li><li><a href="/vuepressBlog/techNote/basic/network/Chap3.html" class="sidebar-link">Chap3 传输层</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap3.html#_3-1-传输层服务简介" class="sidebar-link">3.1 传输层服务简介</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap3.html#_3-2-多路复用和多路分解" class="sidebar-link">3.2 多路复用和多路分解</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap3.html#_3-3-无连接运输-udp" class="sidebar-link">3.3 无连接运输：UDP</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap3.html#_3-4-可靠数据传输原理" class="sidebar-link">3.4 可靠数据传输原理</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap3.html#_3-5-面向连接的运输-tcp" class="sidebar-link">3.5 面向连接的运输：TCP</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap3.html#_3-6-拥塞控制原理" class="sidebar-link">3.6 拥塞控制原理</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap3.html#_3-7-tcp拥塞控制" class="sidebar-link">3.7 TCP拥塞控制</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/network/Chap3.html#_3-8-传输层功能发展" class="sidebar-link">3.8 传输层功能发展</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chap4-网络层-数据平面"><a href="#chap4-网络层-数据平面" class="header-anchor">#</a> Chap4 网络层——数据平面</h1> <h2 id="_4-1-网络层概览"><a href="#_4-1-网络层概览" class="header-anchor">#</a> 4.1 网络层概览</h2> <p>数据平面中，路由器的首要任务是将数据报从输入链路转发到输出链路；</p> <p>控制平面中，路由器的首要任务是协调局部的路由器的转发行为，确保数据报最终到达</p> <ul><li>转发（forwarding）：路由器局部行为，将一个包从输入链路转移到输出链路，耗时几纳秒，通常在硬件层实现</li> <li>路由（routing）：网络全局行为，决定端到端路径，耗时几毫秒，通常在软件层实现</li></ul> <h2 id="_4-2-路由器结构"><a href="#_4-2-路由器结构" class="header-anchor">#</a> 4.2 路由器结构</h2> <ul><li>路由器概览图</li></ul> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzul17mhm3j20re0d6gmq.jpg" alt="image-20220301185858774"></p> <ul><li>输入端口处理 / 终点导向的转发</li></ul> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzuob5f57yj20nb05kgm0.jpg" alt="image-20220301205218204"></p> <ul><li>转发表-将key-value转化为前缀查找树，降低存储空间，若同时存在多个匹配，采取最长前缀匹配准则</li></ul> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzuog4xz7ij20mt0bvdgt.jpg" alt="image-20220301205707330" style="zoom:40%;"><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzuozu9f4yj20l8052jrl.jpg" alt="image-20220301211603455" style="zoom:40%;"></p> <ul><li><p>转发结构（switching fabric）的三种实现方式，左边的是blocking的，右边的可以并行</p> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzvk2px41fj20p00g2dhb.jpg" alt="image-20220302151123786"></p></li> <li><p>输出端口处理</p> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzvkn0024uj20k404waac.jpg" alt="image-20220302153053619"></p></li> <li><p>输入队列的队头阻塞（Head-of-the-line blocking，HOL）</p></li></ul> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzvysacpqgj20i40i50u3.jpg" alt="image-20220302234019369"></p> <ul><li><p>输出队列（满了会丢包，使用Random Early Detection算法进行主动的队列管理）</p> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzw0kly5awj20i30f63zn.jpg" alt="image-20220303004209824"></p></li> <li><p>缓存设置</p> <ul><li>双刃剑：较大的缓存能吸收短期的流量波动，降低丢包率，但会增加端到端延迟（bufferbloat现象）</li> <li>经验公式： <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="17.914ex" height="2.656ex" viewBox="0 -924 7918 1174" style="vertical-align:-0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mo" transform="translate(1036.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(2092.6, 0)"><path data-c="52" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path></g><g data-mml-node="mi" transform="translate(2851.6, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(3555.6, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mo" transform="translate(4481.8, 0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="mi" transform="translate(4982, 0)"><path data-c="43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(5697, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="msqrt" transform="translate(6197, 0)"><g transform="translate(833, 0)"><g data-mml-node="mi"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g></g><g data-mml-node="mo" transform="translate(0, 64)"><path data-c="221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"></path></g><rect width="888" height="60" x="833" y="804"></rect></g></g></g></svg></mjx-container> ，其中，<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span></span> 代表缓存大小，<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="4.903ex" height="1.593ex" viewBox="0 -683 2167 704" style="vertical-align:-0.048ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="52" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path></g><g data-mml-node="mi" transform="translate(759, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(1463, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g></svg></mjx-container> 代表平均往返时间，<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span></span></span> 代表链路容量，<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></span> 代表独立TCP流的数量（2004）</li></ul></li> <li><p>数据包调度（以何种方式发送输出队列中的数据包）</p> <ul><li>FIFO</li></ul> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwqu8s8nyj20os08c74v.jpg" alt="image-20220303155100788"></p> <ul><li>Priority Queuing（深色的高优先级）</li></ul> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwqvd5n6nj20os08474v.jpg" alt="image-20220303155205536"></p> <ul><li>Weighted Fair Queuing（深浅代表两类）</li></ul> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwrmvvmwoj20oq08baan.jpg" alt="image-20220303161832278"></p></li></ul> <h2 id="_4-3-互联网协议-ipv4-地址-ipv6"><a href="#_4-3-互联网协议-ipv4-地址-ipv6" class="header-anchor">#</a> 4.3 互联网协议：IPv4，地址，IPv6</h2> <h3 id="_4-3-1-ipv4-数据报格式"><a href="#_4-3-1-ipv4-数据报格式" class="header-anchor">#</a> 4.3.1 IPv4 数据报格式</h3> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwrqtrj4pj20hv0crq3q.jpg" alt="image-20220303162219344"></p> <ul><li><p>Version number：IP协议的版本，路由器根据其处理剩余的数据报内容</p></li> <li><p>Header Length：因为Options的存在，需要说明头部长度以决定数据的起始位置，无options时，通常是20字节长</p></li> <li><p>Type of service：区分不同类型的数据报</p></li> <li><p>Datagram length：IP数据报（header+data）总字节数，此字段16比特，故IP数据报最大大小是65535字节，然而实际上，IP数据报一般小于1500字节，以适应以太网帧的大小</p></li> <li><p>Identifier，flags，fragmentation offset：用于标示一个大的数据报被拆分成若干小数据报的组装工作，IPv6不支持了</p></li> <li><p>Time to live：若TTL到达0，则路由器会丢弃这个数据报，确保数据报不会在网络中一直循环</p></li> <li><p>Protocol：当数据报到达目的地时，接收方会根据这个字段决定将数据交给哪个传输层协议去解析，如6代表TCP，17代表UDP，更多可能值，查看IANA Protocol Numbers 2016</p></li> <li><p>Header checksum：协助路由器检测IP数据报中的比特错误，若出错，则丢弃；注意每个路由器会因为TTL的变化，重新算一个checksum，一种快速算checksum的算法参考RFC 1071</p></li> <li><p>Source and destination IP address</p></li> <li><p>Options：IPv4中有，IPv6中没有</p></li> <li><p>Data：传输层报文，或者其他类型数据，如ICMP信息</p></li></ul> <h3 id="_4-3-2-ipv4-地址"><a href="#_4-3-2-ipv4-地址" class="header-anchor">#</a> 4.3.2 IPv4 地址</h3> <ul><li><p>IPv4地址长度为4字节，32个比特，故理论上有 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="2.844ex" height="1.887ex" viewBox="0 -833.9 1257.1 833.9" style="vertical-align:0;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(500, 363) scale(0.707)"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g></g></g></svg></mjx-container> 个IP地址（约40亿）</p></li> <li><p>每个主机和路由器的每个link都具有IP地址</p></li> <li><p>互联网地址分配策略（Classless Interdomain Routing，CIDR，RFC4632），贯彻了子网的概念，将32位地址划分成前后两部分 a.b.c.d/x，其中，x代表前面一部分的位数，这样，就能形成层次化的消息传递机制</p></li></ul> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzx0ya99wsj20g10gn0tm.jpg" alt="image-20220303214024380"></p> <ul><li><p>IP地址中，255.255.255.255用于广播，数据包会发送给子网里的每一个用户，路由器选择性将此信息外发到相邻子网</p></li> <li><p>IP地址的块分配（分给ISP们）和DNS根服务器是由Internet Corporation for Assigned Names and Numbers，ICANN组织管理的，遵守RFC 7020中的规定</p></li> <li><p>IP地址的单机分配一般使用Dynamic Host Configuration Protocol，DHCP，[RFC2131]。DHCP会进行动态IP分配，并告知主机一些额外信息，如子网掩码，首个接入路由器的地址，本地DNS服务器IP。DHCP是一个零配置的协议，即插即用</p></li></ul> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzx2ffa20rj20ly0gsmy4.jpg" alt="image-20220303223157696"></p> <ul><li>对于新入网的主机，DHCP协议的执行主要分为以下四步
<ul><li>1、DHCP服务发现：入网主机发送广播，使用UDP发DHCP discover message数据包到67端口</li> <li>2、DHCP服务应答：DHCP服务器收到该信息后，广播一个DHCP offer message数据包，里面包含与discover包中相同的transaction ID，以及Lifetime（IP地址的有效时间，一般设为几个小时或几天）</li> <li>3、DHCP请求：入网主机会从单个或多个DHCP服务应答中选择一个，并朝那个DHCP服务器发送DHCP请求，包含该DHCP服务应答的配置信息</li> <li>4、DHCP应答：DHCP服务器会发送一个DHCP应答信息给入网主机</li></ul></li></ul> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzx2hlymfuj20gb0m8wgd.jpg" alt="image-20220303223403040"></p> <ul><li>入网主机收到DHCP应答后，可以使用DHCP分配的IP地址在有效期内进行通信，有效期结束后，DHCP提供更新有效期的机制</li></ul> <h3 id="_4-3-3-网络地址翻译-nat"><a href="#_4-3-3-网络地址翻译-nat" class="header-anchor">#</a> 4.3.3 网络地址翻译（NAT）</h3> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzx3ait5ozj20r10d6q4e.jpg" alt="image-20220303230150504"></p> <ul><li>支持NAT的路由器是一个子网对外的接口，使用相同的IP地址对外发出请求，NAT翻译表中，将广域网的IP地址+端口和局域网的IP地址+端口形成一一映射。这样，能使不同子网间可能存在相同的IP地址，从而节省IP地址资源，且不影响正常工作。</li> <li>外网的机器如何连接一个躲在NAT服务器后面的主机（不知道其IP）呢？技术方案是使用NAT穿透工具，参见RFC5389</li></ul> <h3 id="_4-3-4-ipv6"><a href="#_4-3-4-ipv6" class="header-anchor">#</a> 4.3.4 IPV6</h3> <ul><li><p>IPV4地址面临用尽的危机，故发展IPv6，RFC2460；（有过IPv5，但被放弃了）</p></li> <li><p>IPv6数据报格式</p> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzx3oq4o2uj20i109wgm1.jpg" alt="image-20220303231529804"></p> <ul><li>Version：4比特，IP版本标识号，IPv6是6</li> <li>Traffic Class：8比特，设置流里的数据报优先级</li> <li>Flow label：20比特，流标签，如音视频可被视作一个流，而文件传输则不被视为一个流</li> <li>Payload length：16比特，unsigned int，表示Data的字节数</li> <li>Next header：交付给什么上层协议解析（如TCP、UDP）</li> <li>Hop limit：允许最大跳数，经过一个路由器就减1，到0就被丢包</li> <li>Source/Destination Address：地址表示位数从32bit上升到128bit，且增加了一种新类型地址，叫做anycast address，允许一个数据报传递给任意一组主机</li></ul></li> <li><p>IPv6的改动</p> <ul><li>不再支持大数据报的切割和组装</li> <li>不设置校验和（TCP等上层协议已经有校验机制，且能避免每个路由器更新TTL带来的校验和计算耗时）</li> <li>删除了options字段，固定40字节的包头，使得路由器的处理更快速</li></ul></li> <li><p>IPv4到IPv6的迁移</p> <ul><li>主流方法是使用隧道【RFC 4213】，如下图所示，将整个IPv6数据报当成IPv4数据报的payload进行传输，并将IPv4的协议编号设为41【RFC 4213】</li> <li><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzx4v3pxp3j20lc0gata5.jpg" alt="image-20220303235613312"></li></ul></li></ul> <h2 id="_4-4-广义的转发"><a href="#_4-4-广义的转发" class="header-anchor">#</a> 4.4 广义的转发</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">4/5/2022, 12:49:07 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/vuepressBlog/assets/js/app.79827240.js" defer></script><script src="/vuepressBlog/assets/js/2.ab72813d.js" defer></script><script src="/vuepressBlog/assets/js/51.289135c1.js" defer></script>
  </body>
</html>
