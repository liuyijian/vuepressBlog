<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>现代操作系统——原理与实现 | lyj Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.0/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css">
    <meta name="description" content="我来到，我看见，我记录">
    
    <link rel="preload" href="/vuepressBlog/assets/css/0.styles.bc106160.css" as="style"><link rel="preload" href="/vuepressBlog/assets/js/app.6b528729.js" as="script"><link rel="preload" href="/vuepressBlog/assets/js/2.ab72813d.js" as="script"><link rel="preload" href="/vuepressBlog/assets/js/49.0df47a3b.js" as="script"><link rel="prefetch" href="/vuepressBlog/assets/js/10.8dbed780.js"><link rel="prefetch" href="/vuepressBlog/assets/js/100.265d117f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/101.8f8a8877.js"><link rel="prefetch" href="/vuepressBlog/assets/js/102.23d7fb47.js"><link rel="prefetch" href="/vuepressBlog/assets/js/103.1d17fb3c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/104.264b70e0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/105.03575d7f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/106.9c1f2507.js"><link rel="prefetch" href="/vuepressBlog/assets/js/107.7bb9227b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/108.4ea416bb.js"><link rel="prefetch" href="/vuepressBlog/assets/js/109.cf8ae3d3.js"><link rel="prefetch" href="/vuepressBlog/assets/js/11.8c13b148.js"><link rel="prefetch" href="/vuepressBlog/assets/js/110.1236666f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/111.3c6af209.js"><link rel="prefetch" href="/vuepressBlog/assets/js/112.0979c7a8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/113.028ac5b9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/114.707489a5.js"><link rel="prefetch" href="/vuepressBlog/assets/js/115.927139bd.js"><link rel="prefetch" href="/vuepressBlog/assets/js/116.e244de92.js"><link rel="prefetch" href="/vuepressBlog/assets/js/117.c65e62a1.js"><link rel="prefetch" href="/vuepressBlog/assets/js/118.c3b34688.js"><link rel="prefetch" href="/vuepressBlog/assets/js/12.59432e93.js"><link rel="prefetch" href="/vuepressBlog/assets/js/13.31bd9a84.js"><link rel="prefetch" href="/vuepressBlog/assets/js/14.0b06810f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/15.e0a7d109.js"><link rel="prefetch" href="/vuepressBlog/assets/js/16.d8d547ec.js"><link rel="prefetch" href="/vuepressBlog/assets/js/17.f801f702.js"><link rel="prefetch" href="/vuepressBlog/assets/js/18.ced7fc49.js"><link rel="prefetch" href="/vuepressBlog/assets/js/19.6d9a078f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/20.d6705a8a.js"><link rel="prefetch" href="/vuepressBlog/assets/js/21.6c7be3a0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/22.2f97e4c4.js"><link rel="prefetch" href="/vuepressBlog/assets/js/23.dc5ad835.js"><link rel="prefetch" href="/vuepressBlog/assets/js/24.b5ad9a7c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/25.2346045f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/26.169166b1.js"><link rel="prefetch" href="/vuepressBlog/assets/js/27.a1f119d7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/28.aba4012d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/29.57cce391.js"><link rel="prefetch" href="/vuepressBlog/assets/js/3.23012698.js"><link rel="prefetch" href="/vuepressBlog/assets/js/30.94a6a846.js"><link rel="prefetch" href="/vuepressBlog/assets/js/31.e44548f9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/32.5d9dbd37.js"><link rel="prefetch" href="/vuepressBlog/assets/js/33.cf0304c0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/34.b35a928e.js"><link rel="prefetch" href="/vuepressBlog/assets/js/35.0aa23f25.js"><link rel="prefetch" href="/vuepressBlog/assets/js/36.7c5cbd35.js"><link rel="prefetch" href="/vuepressBlog/assets/js/37.9b6de082.js"><link rel="prefetch" href="/vuepressBlog/assets/js/38.0d6e1bc8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/39.be59fb9d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/4.6fcabf8c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/40.8b80be1d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/41.23df62c1.js"><link rel="prefetch" href="/vuepressBlog/assets/js/42.35a8f997.js"><link rel="prefetch" href="/vuepressBlog/assets/js/43.9ce1d5e9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/44.bae8e83b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/45.35ce70d4.js"><link rel="prefetch" href="/vuepressBlog/assets/js/46.e06716a9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/47.b7e42841.js"><link rel="prefetch" href="/vuepressBlog/assets/js/48.22a60f9c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/5.1d5afe99.js"><link rel="prefetch" href="/vuepressBlog/assets/js/50.5f971bb0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/51.5337bbe5.js"><link rel="prefetch" href="/vuepressBlog/assets/js/52.4aad9c1e.js"><link rel="prefetch" href="/vuepressBlog/assets/js/53.65883b8c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/54.b19ee5b4.js"><link rel="prefetch" href="/vuepressBlog/assets/js/55.6d78921b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/56.26edb079.js"><link rel="prefetch" href="/vuepressBlog/assets/js/57.16de1284.js"><link rel="prefetch" href="/vuepressBlog/assets/js/58.57c9ad4f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/59.d7a83af1.js"><link rel="prefetch" href="/vuepressBlog/assets/js/6.b0f500a7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/60.ef641f0b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/61.06ada8a9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/62.c201181c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/63.5e0956b9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/64.1333c3ce.js"><link rel="prefetch" href="/vuepressBlog/assets/js/65.85bd3acc.js"><link rel="prefetch" href="/vuepressBlog/assets/js/66.91aa8c33.js"><link rel="prefetch" href="/vuepressBlog/assets/js/67.43f04cc7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/68.8c167799.js"><link rel="prefetch" href="/vuepressBlog/assets/js/69.799a9ad6.js"><link rel="prefetch" href="/vuepressBlog/assets/js/7.0ebb7ad8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/70.ed6ad575.js"><link rel="prefetch" href="/vuepressBlog/assets/js/71.8aa5c2a3.js"><link rel="prefetch" href="/vuepressBlog/assets/js/72.8959f876.js"><link rel="prefetch" href="/vuepressBlog/assets/js/73.2591c30a.js"><link rel="prefetch" href="/vuepressBlog/assets/js/74.9a3e7ac8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/75.e902c941.js"><link rel="prefetch" href="/vuepressBlog/assets/js/76.097b0b26.js"><link rel="prefetch" href="/vuepressBlog/assets/js/77.30a31958.js"><link rel="prefetch" href="/vuepressBlog/assets/js/78.ce43dac1.js"><link rel="prefetch" href="/vuepressBlog/assets/js/79.9f0ed644.js"><link rel="prefetch" href="/vuepressBlog/assets/js/8.f2c8fce2.js"><link rel="prefetch" href="/vuepressBlog/assets/js/80.da97703b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/81.10ce4d4f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/82.2d30f3d7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/83.5b635648.js"><link rel="prefetch" href="/vuepressBlog/assets/js/84.eef88086.js"><link rel="prefetch" href="/vuepressBlog/assets/js/85.9340d932.js"><link rel="prefetch" href="/vuepressBlog/assets/js/86.067a1e76.js"><link rel="prefetch" href="/vuepressBlog/assets/js/87.ff6fc498.js"><link rel="prefetch" href="/vuepressBlog/assets/js/88.448d4393.js"><link rel="prefetch" href="/vuepressBlog/assets/js/89.2dcf3001.js"><link rel="prefetch" href="/vuepressBlog/assets/js/9.1aea8c91.js"><link rel="prefetch" href="/vuepressBlog/assets/js/90.8d5c1be2.js"><link rel="prefetch" href="/vuepressBlog/assets/js/91.84fca09d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/92.0c6e9ee5.js"><link rel="prefetch" href="/vuepressBlog/assets/js/93.94030fdd.js"><link rel="prefetch" href="/vuepressBlog/assets/js/94.632a92a4.js"><link rel="prefetch" href="/vuepressBlog/assets/js/95.0327fc6f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/96.6cbe2c2b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/97.bab10e51.js"><link rel="prefetch" href="/vuepressBlog/assets/js/98.1f3d3a36.js"><link rel="prefetch" href="/vuepressBlog/assets/js/99.f3b11738.js">
    <link rel="stylesheet" href="/vuepressBlog/assets/css/0.styles.bc106160.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepressBlog/" class="home-link router-link-active"><!----> <span class="site-name">lyj Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepressBlog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TechNote" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="TechNote" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础知识
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/algorithms/" class="nav-link">
  基础算法
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/network/" class="nav-link">
  网络原理
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/os/" class="nav-link router-link-active">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          算法研究
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/recommendation_system/" class="nav-link">
  推荐系统
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/knowledge_graph/" class="nav-link">
  知识图谱
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/nlp/" class="nav-link">
  自然语言处理
</a></li></ul></li><li class="dropdown-item"><h4>
          工程实践
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/FFmpeg/" class="nav-link">
  FFmpeg
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Python/" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="InvestNote" class="dropdown-title"><span class="title">投资心得</span> <span class="arrow down"></span></button> <button type="button" aria-label="InvestNote" class="mobile-dropdown-title"><span class="title">投资心得</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/economic/" class="nav-link">
  经济
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/chan/" class="nav-link">
  缠论
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/options/" class="nav-link">
  期权
</a></li></ul></div></div><div class="nav-item"><a href="/vuepressBlog/resource/" class="nav-link">
  资源聚合
</a></div> <a href="https://github.com/liuyijian/vuepressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepressBlog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TechNote" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="TechNote" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础知识
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/algorithms/" class="nav-link">
  基础算法
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/network/" class="nav-link">
  网络原理
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/os/" class="nav-link router-link-active">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          算法研究
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/recommendation_system/" class="nav-link">
  推荐系统
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/knowledge_graph/" class="nav-link">
  知识图谱
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/nlp/" class="nav-link">
  自然语言处理
</a></li></ul></li><li class="dropdown-item"><h4>
          工程实践
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/FFmpeg/" class="nav-link">
  FFmpeg
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Python/" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="InvestNote" class="dropdown-title"><span class="title">投资心得</span> <span class="arrow down"></span></button> <button type="button" aria-label="InvestNote" class="mobile-dropdown-title"><span class="title">投资心得</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/economic/" class="nav-link">
  经济
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/chan/" class="nav-link">
  缠论
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/options/" class="nav-link">
  期权
</a></li></ul></div></div><div class="nav-item"><a href="/vuepressBlog/resource/" class="nav-link">
  资源聚合
</a></div> <a href="https://github.com/liuyijian/vuepressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>操作系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepressBlog/techNote/basic/os/Chap1.html" aria-current="page" class="active sidebar-link">Chap1</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/os/Chap1.html#chap1-操作系统概述" class="sidebar-link">Chap1 操作系统概述</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/os/Chap1.html#chap2-硬件结构" class="sidebar-link">Chap2 硬件结构</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/os/Chap1.html#chap3-操作系统结构" class="sidebar-link">Chap3 操作系统结构</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/os/Chap1.html#chap4-内存管理" class="sidebar-link">Chap4 内存管理</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/os/Chap1.html#chap5-进程与线程" class="sidebar-link">Chap5 进程与线程</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/os/Chap1.html#chap6-操作系统调度" class="sidebar-link">Chap6 操作系统调度</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/os/Chap1.html#chap7-进程间通信" class="sidebar-link">Chap7 进程间通信</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/os/Chap1.html#chap8-同步原语" class="sidebar-link">Chap8 同步原语</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/os/Chap1.html#chap9-文件系统" class="sidebar-link">Chap9 文件系统</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/os/Chap1.html#chap10-设备管理" class="sidebar-link">Chap10 设备管理</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/basic/os/Chap1.html#chap11-系统虚拟化" class="sidebar-link">Chap11 系统虚拟化</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="现代操作系统-原理与实现"><a href="#现代操作系统-原理与实现" class="header-anchor">#</a> 现代操作系统——原理与实现</h1> <h2 id="chap1-操作系统概述"><a href="#chap1-操作系统概述" class="header-anchor">#</a> Chap1 操作系统概述</h2> <h4 id="操作系统的作用"><a href="#操作系统的作用" class="header-anchor">#</a> 操作系统的作用</h4> <ul><li>对硬件进行管理和抽象
<ul><li>管理硬件：将功能不同，参数不同的硬件纳入统一管理（如硬盘、内存、显卡）</li> <li>对硬件进行抽象：将有限的、离散的资源高效抽象为无限的，连续的资源，开发者无需关心硬件具体细节（如面向虚拟地址空间编程而非物理内存）</li></ul></li> <li>为应用提供服务并进行管理
<ul><li>服务于应用：提供不同层次、不同功能的接口满足应用需求（如系统调用），提供访问控制，应用间交互服务等</li> <li>管理应用：负责应用生命周期的管理，如应用加载、启动、切换、调度、销毁等，从全局角度分配系统资源，保证公平性、性能和安全的隔离性</li></ul></li></ul> <h4 id="操作系统的必要性"><a href="#操作系统的必要性" class="header-anchor">#</a> 操作系统的必要性</h4> <ul><li>避免应用直接控制硬件不当带来的计算机直接崩溃，提供诊断和调试的机会</li> <li>从全局角度合理调度应用，高效利用硬件资源</li></ul> <h4 id="操作系统接口"><a href="#操作系统接口" class="header-anchor">#</a> 操作系统接口</h4> <ul><li>系统调用接口：系统调用是用户态应用向操作系统内核请求服务的方法</li> <li>POSIX接口：可移植操作系统接口，保证同一个应用程序在不同操作系统上的可移植性（基于不同操作系统的系统调用存在差异），其标准常通过（C library，libc）来实现，常见的libc包括glibc、musl、bionic（Android）</li> <li>领域应用接口：在POSIX基础上封装面向不同领域的领域应用接口，如Android应用框架、IOS应用框架、ROS</li></ul> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gsxtrk71wmj30sd0pwahp.jpg" style="zoom:50%;"> <h4 id="实验操作系统-chcore"><a href="#实验操作系统-chcore" class="header-anchor">#</a> 实验操作系统 - ChCore</h4> <ul><li>采取微内核架构的设计理念</li></ul> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gsxs50aei6j30xz0n3dj6.jpg" style="zoom:50%;"> <h2 id="chap2-硬件结构"><a href="#chap2-硬件结构" class="header-anchor">#</a> Chap2 硬件结构</h2> <h4 id="冯诺伊曼结构的组成"><a href="#冯诺伊曼结构的组成" class="header-anchor">#</a> 冯诺伊曼结构的组成</h4> <ul><li>中央处理单元：负责运算和逻辑控制，按照程序中的指令进行计算</li> <li>存储器：负责存储指令与数据，保存程序执行中间结果和最终结果，包括寄存器、CPU缓存、内存、硬盘等存储层次</li> <li>输入输出：负责与外界进行交互，从外界获得输入（键盘、鼠标），将结果向外界输出（显示器、打印机）</li></ul> <h4 id="指令集架构"><a href="#指令集架构" class="header-anchor">#</a> 指令集架构</h4> <ul><li>指令集架构（ISA）：CPU和软件之间的桥梁
<ul><li>指令集：一系列不同功能的指令，用于数据搬移、计算、访存、过程调用等（本书是AArch64平台的RISC，每条指令长度固定为4字节）</li> <li>特权级：又称为异常级别（EL）
<ul><li>EL0：用户态，应用程序通常运行的特权级，最低的特权级</li> <li>EL1：内核态，操作系统通常运行的特权级</li> <li>EL2：虚拟机监控器（VMM）通常运行的特权级</li> <li>EL3：和TrustZone相关，负责普通世界和安全世界之间的切换（TrustZone是Armv6引入的安全特性，安全世界不受限制访问所有计算资源，普通世界不能访问划分到安全世界的计算资源）</li> <li>EL0 -&gt; EL1的三种经典场景（前两个是同步的CPU特权级切换，最后的是异步的）
<ul><li>1、应用程序需要调用操作系统提供的系统调用</li> <li>2、应用程序执行了一条指令触发了异常（如访存指令触发缺页异常），内核通过查找异常向量表来做适当处理后返回用户态</li> <li>3、应用程序执行过程中，CPU收到来自外设的中断</li></ul></li></ul></li> <li>寄存器
<ul><li>AArch64中，有31个64位通用寄存器（X0~X30）
<ul><li>X29是帧指针寄存器（FP），一般保存函数调用过程中栈顶的地址</li> <li>X30是链接指针寄存器（LP），一般保存函数调用后的返回地址</li></ul></li> <li>在EL1特权级下，有2个页表基地址寄存器（TTBR），负责翻译虚拟地址空间中不同的地址段
<ul><li>TTBR0_EL1：一般用于负责用户地址空间的地址映射</li> <li>TTBR1_EL1：一般用于负责内核地址空间的地址映射</li></ul></li></ul></li> <li>执行模式、安全扩展、性能加速扩展等</li></ul></li></ul> <h4 id="cpu缓存"><a href="#cpu缓存" class="header-anchor">#</a> CPU缓存</h4> <ul><li>访问CPU缓存比访问物理内存快，由于软件运行具有局部性（时间、空间），缓存能有效提升性能</li> <li>以下为256组，2路组相连缓存，缓存行大小64字节，缓存总大小为32KB，查找时，将物理地址切成三段，先进入对应set的编号里，再根据tag找到特定的缓存行，再根据valid位置决定是否直接读取或更新缓存行</li></ul> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gsxtt40cw2j313w0mg78l.jpg" alt=""></p> <h4 id="设备与中断"><a href="#设备与中断" class="header-anchor">#</a> 设备与中断</h4> <p>内存映射输入输出（MMIO）：</p> <ul><li>把输入输出设备和物理内存放到同一个地址空间，为设备内部的内存和寄存器也分配相应地址</li> <li>CPU能使用访存指令操作设备，设备会通过总线监听CPU分配给自己的地址，完成相应的访问请求</li></ul> <p>CPU如何得知输入事件发生了：</p> <ul><li>1、轮询（polling）：CPU不断通过MMIO查看设备是否有输入（会使CPU长期处于等待状态，浪费资源）</li> <li>2、中断（interrupt）：设备通过向CPU发出中断来打断CPU执行，使CPU去处理这个中断</li></ul> <h2 id="chap3-操作系统结构"><a href="#chap3-操作系统结构" class="header-anchor">#</a> Chap3 操作系统结构</h2> <h4 id="操作系统复杂度"><a href="#操作系统复杂度" class="header-anchor">#</a> 操作系统复杂度</h4> <p>控制系统复杂度的设计原则：策略与机制分离</p> <ul><li>策略（policy）：表示要做什么</li> <li>机制（mechanism）：表示该如何做</li></ul> <p>操作系统可以通过多种不同策略来适应不同应用需求，也可以通过持续优化具体的机制来不断完善一个策略的实现</p> <p>管理复杂度的重要方法：MALH方法</p> <ul><li>模块化（modularity）：将系统分解为通过明确定义接口交互的模块，要求模块高内聚、低耦合</li> <li>抽象（abstraction）：在模块化基础上，将接口与内部实现分离</li> <li>分层（layering）：将模块进行层次的划分，约束每层内部模块间的交互方式与跨层模块间的交互方式（一般不准跨两层交互），有效减少模块交互</li> <li>层级（hierarchy）：将功能相近的模块组成一个自包含的子系统，再将其递归组成一个大系统</li></ul> <h4 id="操作系统内核架构"><a href="#操作系统内核架构" class="header-anchor">#</a> 操作系统内核架构</h4> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gsxuco4kgmj31cv0m37ay.jpg" style="zoom:50%;"> <table><thead><tr><th>架构种类</th> <th>代表系统</th> <th>特性</th> <th>优点</th> <th>缺点</th></tr></thead> <tbody><tr><td>简要结构</td> <td>MS-DOS、FreeRTOS、uCOS</td> <td></td> <td>轻量化，适用于在微控制器单元上运行</td> <td>应用程序和操作系统放置在同一个地址空间，特权级隔离能力较弱甚至无，单个应用或模块出错会导致系统崩溃</td></tr> <tr><td>宏内核（单内核）</td> <td>UNIX、Linux、Windows</td> <td>一切皆是文件的抽象</td> <td>提供可加载内核模块（LKM）机制，使设备驱动开发和加载更方便灵活；调度子系统对进程优先级进行分类</td> <td>通用大型系统难以满足特定场景下安全性、可靠性、实时性等需求；内核单点错误会导致系统崩溃或被攻破；在庞大系统中创新非常困难</td></tr> <tr><td>微内核</td> <td>Mach、L4、EROS、seL4</td> <td>将单个功能（如文件系统、设备驱动）从宏内核中拆分出来，作为一个独立的服务部署到独立的运行环境中；内核仅保留进程间通信（IPC）等极少数基础功能</td> <td>服务间完全隔离，便于为不同场景定制不同的服务,弹性扩展能力强，支持硬件异构程度高，时延相对可控</td> <td>进程间通信（IPC）可能成为性能瓶颈</td></tr> <tr><td>外核</td> <td>UniKernel，容器架构</td> <td>过度的硬件资源抽象可能带来较大的性能损失，且对一些如数据库，web服务器等具体应用，抽象往往不是最优选择。故提出让应用尽可能控制对硬件资源的抽象，提出库操作系统的概念（libos），将硬件的抽象封装至libos中，与应用直接链接，而内核至负责对硬件资源在多个libos之间的多路复用的支持，管理libos的生命周期</td> <td>可根据应用领域的特点和需求，动态组装libos，最小化非必要代码，获取更高性能；内核可以做到非常小，libos之间的强隔离带来系统的安全性和可靠性</td> <td>libos缺乏跨场景的通用性，应用生态差；不同的libos常会实现类似功能容易造成代码冗余</td></tr> <tr><td>多内核</td> <td></td> <td>每个CPU核上运行一个独立的操作系统节点，节点间交互通过进程间通信完成，通过多内核管理异构多核设备</td> <td>避免了处理器核之间通过共享内存实现隐式共享带来的性能可扩展性瓶颈</td> <td>不同节点间可能存在状态冗余，需要移植应用适配多内核架构</td></tr></tbody></table> <h2 id="chap4-内存管理"><a href="#chap4-内存管理" class="header-anchor">#</a> Chap4 内存管理</h2> <h4 id="虚拟地址与物理地址"><a href="#虚拟地址与物理地址" class="header-anchor">#</a> 虚拟地址与物理地址</h4> <ul><li><p>虚拟内存（virtual memory）：</p></li> <li><p>操作系统为了让不同应用程序高效又安全地共同使用物理内存资源，在应用程序和物理内存之间加入的一个新的抽象</p></li> <li><p>访存流程：</p> <ul><li><p>应用程序运行时只能使用虚拟地址</p></li> <li><p>CPU中的内存管理单元（MMU）负责将虚拟地址翻译成物理地址</p> <ul><li>为了加速地址翻译过程，MMU内部引入了转址旁路缓存（Translation Lookaside Buffer，TLB）</li></ul></li> <li><p>操作系统负责设置虚拟地址和物理地址之间的映射</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gt2jp747e7j31cm0e5afz.jpg" alt=""></p></li></ul></li> <li><p>分段与分页机制</p> <ul><li>分段机制（x86-64架构前的主流，当下硬件仍然兼容）
<ul><li>描述：操作系统以段（一段连续物理内存）的形式管理/分配物理内存；应用程序的虚拟地址空间由若干不同大小的段组成（代码段、数据段），虚拟地址空间的相邻段在物理空间不一定相邻，故操作系统可以实现物理内存资源的离散分配</li> <li>虚拟地址的构成：段号、段内偏移</li> <li>翻译地址过程：MMU先通过<strong>段表基址寄存器</strong>找到段表（段表存储虚拟地址空间中每一个分段的段起始物理地址和段长）的位置，根据段号和段内偏移获取最终物理地址（段内偏移和段长结合可检查地址是否超出合法范围）</li> <li>评价：容易造成物理上的<strong>外部碎片（段与段间不足以映射给虚拟地址空间的段）</strong>，从而降低物理内存资源利用率</li></ul></li> <li>分页机制（主流）
<ul><li>描述：将虚拟地址空间划分为连续的、等长的虚拟页；物理内存也划分为连续的、等长的物理页；虚拟页和物理页的页长固定且相等</li> <li>虚拟地址的构成：虚拟页号、页内偏移</li> <li>翻译地址过程：MMU先通过<strong>页表基地址寄存器</strong>找到页表（虚拟页到物理页的映射关系表），用物理页起始地址加上页内偏移获取最终物理地址</li> <li>评价：有效避免外部碎片问题</li></ul></li></ul></li></ul> <h4 id="基于分页的虚拟内存"><a href="#基于分页的虚拟内存" class="header-anchor">#</a> 基于分页的虚拟内存</h4> <ul><li>对于64位虚拟地址空间，若页大小为4KB，页表中每项大小为8字节，则页表大小为<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="22.426ex" height="2.47ex" viewBox="0 -841.7 9912.1 1091.7" style="vertical-align:-0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(500, 363) scale(0.707)"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g></g></g><g data-mml-node="TeXAtom" transform="translate(1257.1, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mn" transform="translate(1757.1, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(2257.1, 0)"><path data-c="4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(3106.1, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mo" transform="translate(4087.3, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(4809.6, 0)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mi" transform="translate(5309.6, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mo" transform="translate(6346.3, 0)"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g><g data-mml-node="mn" transform="translate(7402.1, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(8402.1, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(9153.1, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g></g></g></svg></mjx-container>，需要压缩！</li> <li>使用<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span></span>级页表，虚拟页号被划分为<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span></span>个部分，当任意一级页表的某一个条目为空时，该条目对应的下一级页表不需要存在，即多级页表允许结构空洞的存在</li> <li>考虑到应用程序的虚拟地址空间绝大部份处于未分配状态，多级页表在实际使用中，可以部分创建，从而极大节约空间</li></ul> <h5 id="aarch64体系结构下基于4级列表的地址翻译"><a href="#aarch64体系结构下基于4级列表的地址翻译" class="header-anchor">#</a> AArch64体系结构下基于4级列表的地址翻译</h5> <img src="https://tva1.sinaimg.cn/large/008i3skNgy1gt2jotvbspj30wu0rtn2k.jpg" style="zoom:50%;"> <h5 id="加速地址翻译的重要硬件-tlb"><a href="#加速地址翻译的重要硬件-tlb" class="header-anchor">#</a> 加速地址翻译的重要硬件：TLB</h5> <ul><li>TLB缓存了虚拟页号和物理页的映射关系（键值对哈希表），一般而言，TLB分成L1和L2两层，L1又分为数据TLB和指令TLB，分别用于缓存数据和指令的地址翻译；L2不区分数据和指令</li> <li>当TLB未命中时，硬件将通过页表基地址查询页表，找到对应的页表项，并将翻译结果写入TLB中；若TLB已满，则根据预设策略替换掉其中一项</li> <li>由于TLB是使用虚拟地址查询（每个应用程序有自己的虚拟空间）的，故操作系统在进行系统调用、页表切换（应用程序切换）、页表修改时，TLB需要做相应处理，否则会出错
<ul><li>系统调用：在AArch64体系结构上，通常应用程序和操作系统使用不同页表，由于硬件提供TTBR0_EL1和TTBR1_EL1两个不同的页表基地址寄存器，故在系统调用的过程中不需要切换页表，避免TLB刷新的开销</li> <li>页表切换：在AArch64体系结构上，提供了（Address Space IDSpecifier，ASID）功能，为不同的应用程序分配不同的ASID作为应用程序的身份标签（x86中，这个功能叫PCID）将这个标签写入页表基地址寄存器中的空闲位，同时，TLB中的缓存项也包含ASID这个标签，使得TLB中属于不同应用程序的缓存项可以被区分开，切换页表不需刷新TLB</li> <li>页表修改：当修改页表内容后，操作系统需要主动刷新TLB以保证一致性，刷新TLB的粒度包括，刷新全部，刷新指定ASID，刷新指定虚拟地址等等；可根据不同场景选用合适指令最小化TLB刷新的开销</li></ul></li></ul> <h5 id="换页与缺页异常"><a href="#换页与缺页异常" class="header-anchor">#</a> 换页与缺页异常</h5> <ul><li>换页机制基本思想：当物理内存容量不够的时候，操作系统应该将若干物理页的内容写到类似磁盘这种容量更大且更加便宜的存储设备中，就可以回收物理页并继续使用了</li> <li>换出（swap out）：将物理页的内容写入磁盘特定位置，并在应用程序的页表中取出虚拟页的映射，同时记录物理页在磁盘上的位置，此时虚拟页处于<strong>已分配但未映射</strong>的状态</li> <li>换入（swap in）：当应用程序访问已分配但未映射的虚拟页时，会引发<strong>缺页异常</strong>，CPU会运行操作系统预设的缺页异常处理函数，该函数会找到空闲的物理页，将之前写入磁盘的数据重新加载到物理页中，并在页表中填写虚拟页到该物理页的映射</li> <li>预取机制（prefetching）：发生换入操作时，预测哪些页将被访问，提前换入物理内存，减少发生缺页异常的次数，从而降低磁盘操作的耗时。</li> <li>按需页分配（demand paging）：应用程序申请分配内存时，操作系统可选择将新分配的虚拟页标记成已分配但未映射状态，当应用程序真正需要物理内存时才分配物理页，从而提高资源利用率
<ul><li>操作系统记录虚拟页分配状态</li></ul></li></ul> <h5 id="页替换策略"><a href="#页替换策略" class="header-anchor">#</a> 页替换策略</h5> <p>目标：最小化缺页异常次数</p> <ul><li>MIN/OPT策略：优先选择未来最长时间不会再访问的页换出（理论最优策略，但因为无法预知页访问顺序，故实际中难以实现）</li> <li>FIFO策略：优先选择最先换入的页换出（时间开销低，但因为页换入顺序与使用是否频繁无关，故实际表现差）</li> <li>Second Chance策略：除了维护一个页队列外，还为每个物理页维护一个标志位，若访问的页面已在队列中，则设置标志位；从队头寻找将要换出的物理页时，若标记位非空，则将标志位记空并将此页塞回队尾再继续找队头（二次机会）；若标志位为空，则替换此页；改良FIFO</li> <li>LRU策略：优先选择最久未被访问的页面换出（效果接近MIN策略，但实现此策略需要时刻记录CPU访问了哪些物理页，开销较大）</li> <li>MRU策略：优先选择最近访问的页面换出（基于程序不重复访问假设，如看视频不回看）</li> <li>时钟算法策略：Second Chance策略的循环队列版本（想象针臂一圈圈地在检查），较高效</li></ul> <h5 id="工作集模型"><a href="#工作集模型" class="header-anchor">#</a> 工作集模型</h5> <ul><li>定义：应用程序在时刻t的工作集W是它在时间区间[t-x, t]使用的内存页集合，也被视为下一段x时间内会访问的内存页集合</li> <li>意义：指导操作系统的换页策略，优先将非工作集中的页换出</li> <li>追踪方法：工作集时钟算法
<ul><li>操作系统经过固定时间间隔调用工作集追踪函数，追踪函数为每个内存页维护两个状态，上次使用时间和访问位，均初始化为0；</li> <li>调用时，函数检查内存页状态，若访问位为1，则说明本次时间间隔内页面被访问过，故用当前系统时间更新上次使用时间，并重置访问位；若访问位为0，则函数会计算该页的年龄（当前时间 - 上次使用时间），超出阈值x则说明此页不在工作集，替换之</li></ul></li></ul> <h4 id="虚拟内存功能"><a href="#虚拟内存功能" class="header-anchor">#</a> 虚拟内存功能</h4> <p>虚拟内存抽象除了使应用程序拥有独立而连续的虚拟地址空间外，还带来许多有用的功能</p> <ul><li>共享内存（shared memory）
<ul><li>机制：应用程序<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span></span></span></span></span>的虚拟页 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="2.632ex" height="1.891ex" viewBox="0 -683 1163.3 835.7" style="vertical-align:-0.345ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(583, -152.7) scale(0.707)"><path data-c="41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g></g></g></g></svg></mjx-container>和应用程序<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span></span>的虚拟页<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="2.646ex" height="1.885ex" viewBox="0 -683 1169.7 833" style="vertical-align:-0.339ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(583, -150) scale(0.707)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g></g></g></g></svg></mjx-container>被映射到同一物理页 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span></span></span>，不同应用程序之间可以相互通信，传递数据</li></ul></li> <li>写时拷贝（copy-on-write）
<ul><li>场景适用性：
<ul><li>1、当两个应用程序拥有很多相同的内存数据（如相同的动态链接库），若仅在物理内存存储一份，然后以只读方式映射给两个应用程序，能节约内存资源</li> <li>2、应用程序通过fork系统调用创建子程序，初始时，父子程序的全部内存资源和地址空间完全一样，避免内存拷贝操作带来的时间空间开销</li></ul></li> <li>机制：
<ul><li>写时拷贝技术允许应用程序A和应用程序B以只读方式共享一段物理内存</li> <li>一旦某个应用程序修改，会触发缺页异常（违反权限导致的），操作系统会在物理内存中将缺页异常的物理页重新拷贝一份，新拷贝的物理页以可读可写的方式给触发异常的应用程序使用，并恢复应用程序执行</li></ul></li></ul></li> <li>内存去重（memory deduplication）
<ul><li>原理：操作系统可以定期在内存中扫描具有相同内容的物理页，找到映射到这些物理页的虚拟页，然后只保留其中一个物理页，将其他虚拟页都用写时拷贝的方式映射到该物理页，释放其他物理页</li> <li>案例：Linux中的KSM机制</li> <li>缺点：
<ul><li>1、内存去重功能会对应用程序访存时延造成影响（当应用程序写一个被去重的内存页时，会触发缺页异常，又会导致内存拷贝，使性能下降）</li> <li>2、内存去重可能带来安全问题，攻击者在内存中通过穷举的方式构造数据，然后通过访问延迟确认操作系统是否发生了去重，从而通过这种猜测的方式确认系统中是否存在特定敏感数据，一种防御办法是以应用程序粒度来进行内存去重（无法猜其他程序的数据）</li></ul></li></ul></li> <li>内存压缩
<ul><li>机制：当内存资源不足时，操作系统选择最近不太会使用的内存页，压缩其中数据，从而释放空闲内存，当应用程序访问时，再解压即可（在内存中操作，不落盘，保证速度）</li> <li>案例：Linux中的zswap机制
<ul><li>zswap机制在内存中为换页过程提供缓冲区（zswap区域，依然是内存）</li> <li>此机制使内存数据写到磁盘的操作可以延迟完成，拥有高效的磁盘批量I/O，甚至可能避免磁盘I/O</li> <li>图4-8</li></ul></li></ul></li> <li>大页
<ul><li>案例：Linux中的透明大页机制，能自动将一个应用程序中连续的4kB内存页合并成2MB的内存页</li> <li>优点：
<ul><li>1、减少TLB缓存项的使用，提高TLB命中率</li> <li>2、减少页表的级数，提升查询页表的效率</li></ul></li> <li>缺点：
<ul><li>1、应用程序未使用整个大页造成物理内存资源浪费</li> <li>2、使用大页会增加操作系统管理内存的复杂度</li></ul></li></ul></li></ul> <h4 id="物理内存分配与管理"><a href="#物理内存分配与管理" class="header-anchor">#</a> 物理内存分配与管理</h4> <h5 id="目标与评价维度"><a href="#目标与评价维度" class="header-anchor">#</a> 目标与评价维度</h5> <ul><li>更高的内存资源利用率（减少内存碎片）
<ul><li>外部碎片：多次分配和回收后，物理内存上空闲的部分处于离散分布状态，无法被使用</li> <li>内部碎片：分配的内存空间大于实际所需</li> <li><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt684jjhdxj31510gmjvz.jpg" alt=""></li></ul></li> <li>更好的性能（降低分配延迟，节约CPU资源）</li></ul> <h5 id="伙伴系统"><a href="#伙伴系统" class="header-anchor">#</a> 伙伴系统</h5> <ul><li>场景：分配连续的物理内存页</li> <li>思想：将物理内存划分成连续的块，以块为基本单位进行分配，基于伙伴块分裂合并的物理内存分配与回收</li> <li>实现：空闲链表数组</li> <li><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt75mjof8bj30yy0d2mzt.jpg" alt=""></li> <li><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt75n6lzw5j30wo0amjte.jpg" alt=""></li> <li>优点：
<ul><li>1、资源利用率：分裂和合并操作是级联的，能有效缓解外部碎片；但最小分配单位是一个物理页（4KB），会出现严重的内部碎片问题</li> <li>2、性能：确认一个块的伙伴块很简单，因为互为伙伴块的两个块的物理地址仅有一位不同，且该位由块大小决定</li></ul></li></ul> <h5 id="slab分配器"><a href="#slab分配器" class="header-anchor">#</a> SLAB分配器</h5> <ul><li>场景：分配小内存</li> <li>SLAB分配器是一个家族，包括最开始的SLAB分配器，简化设计和复杂度但性能相当的SLUB分配器（Linux2.6后内核的默认分配器），满足内存资源稀缺场景需求但碎片处理方面较弱的SLOB分配器</li> <li>SLUB分配器将伙伴系统分配的大块内存进一步细分成小块内存进行管理。为避免外部碎片问题，SLUB分配器只分配固定大小的内存块，一般是<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="14.75ex" height="2.262ex" viewBox="0 -750 6519.4 1000" style="vertical-align:-0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500, 363) scale(0.707)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(974.3, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(1363.3, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(2141, 0)"><path data-c="2264" d="M674 636Q682 636 688 630T694 615T687 601Q686 600 417 472L151 346L399 228Q687 92 691 87Q694 81 694 76Q694 58 676 56H670L382 192Q92 329 90 331Q83 336 83 348Q84 359 96 365Q104 369 382 500T665 634Q669 636 674 636ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path></g><g data-mml-node="mi" transform="translate(3196.8, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(4074.6, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(5130.4, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(6130.4, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>字节，对于每一种块大小，SLUB分配器会使用独立的内存资源池进行分配</li> <li>具体实现有个体差异，略</li></ul> <h5 id="空闲链表"><a href="#空闲链表" class="header-anchor">#</a> 空闲链表</h5> <ul><li>在用户态的内存分配器（如堆）中常被用到</li></ul> <table><thead><tr><th>名称</th> <th>特性</th> <th>分配</th> <th>回收</th></tr></thead> <tbody><tr><td>隐式空闲链表</td> <td>每个内存块头部存储关于块的空闲状态、大小信息；通过块大小，可找到下一个块的位置</td> <td>分配器查询链表，找到第一块大小足够的空闲内存块返回（若有足量剩余、则分裂块，仅取一部分服务请求，缓解内部碎片问题）</td> <td>分配器检查内存块紧邻前后两个内存块是否空闲，若有空闲，则进行合并，产生更大的空闲块</td></tr> <tr><td>显式空闲链表</td> <td>仅把空闲的内存块放在链表里，每个空闲块需要额外维护两个指针指向前后空闲块（分配时间仅与空闲块数量正相关，在内存使用率高的情况下优势明显）</td> <td></td> <td></td></tr> <tr><td>分离空闲链表</td> <td>维护多条不同的显式空闲链表，每条链表服务固定范围大小的请求（分配时间进一步减小，更好地支持并发操作，近似于best-fit策略）</td> <td></td> <td></td></tr></tbody></table> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt76ijze8qj31080r047b.jpg" style="zoom:50%;"> <h5 id="物理内存与cpu缓存"><a href="#物理内存与cpu缓存" class="header-anchor">#</a> 物理内存与CPU缓存</h5> <ul><li>动机：操作系统给应用程序分配物理页时，若能分配尽量不会造成缓存冲突的物理页，就能将更多的应用数据存在缓存中，提升访存性能</li> <li>方案：
<ul><li>软件：采用缓存着色（cache coloring）机制，可能造成缓存冲突的物理页染上同一种颜色，在为连续虚拟内存页分配物理页时，优先选择不同颜色的物理页进行分配</li> <li>硬件：如Intel缓存分配技术（CAT）和AArch64上的MPAM技术，通过限制应用程序能使用的最末级缓存（每个CPU核心能同时运行不同程序），避免应用程序互相竞争带来性能抖动</li></ul></li></ul> <h2 id="chap5-进程与线程"><a href="#chap5-进程与线程" class="header-anchor">#</a> Chap5 进程与线程</h2> <h4 id="进程"><a href="#进程" class="header-anchor">#</a> 进程</h4> <h5 id="进程的状态"><a href="#进程的状态" class="header-anchor">#</a> 进程的状态</h5> <ul><li>新生状态-预备状态-运行状态-阻塞状态-终止状态</li></ul> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtcpwd34gmj61970bj0xf02.jpg" alt=""></p> <h5 id="进程的内存空间布局"><a href="#进程的内存空间布局" class="header-anchor">#</a> 进程的内存空间布局</h5> <ul><li><p>进程具有独立的虚拟内存空间，典型的布局包括如下元素</p> <ul><li>用户栈：栈保存进程需要使用的各种临时数据（如临时变量的值），栈的扩展方向是自顶向下，栈底在高地址上</li> <li>代码库：进程执行需要依赖共享的代码库（如libc），代码库会被映射到用户栈下方，并被标记为只读</li> <li>用户堆：堆管理进程动态分配的内存，堆的扩展方向是自底向上的</li> <li>数据与代码段：在进程执行前，操作系统会将二进制文件载入虚拟地址空间，其中，数据段主要保存全局变量的值，代码段保存的是进程执行所需的代码</li> <li>内核部分：处于进程地址空间最顶端，每个进程的虚拟地址空间都映射了相同的内核内存；用户态运行时，内核内存是不可见的；内核态运行时，才能访问内核部分的代码和数据段以及内核栈</li></ul> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gtcq701s9fj60os11ethz02.jpg" style="zoom:40%;"></li> <li><p>在Linux中，可以使用<code>cat /proc/${PID}/maps</code>查看某个进程的内存空间布局，返回六列，其中vdso和vvar是与系统调用相关的内存区域</p> <ul><li>address: 0085d000-00872000 虚拟内存区域的起始和终止地址文件所占的地址空间</li> <li>perms:rw-p 权限：r=read, w=write, x=execute, s=shared, p=private(copy on write)</li> <li>offset: 00000000 虚拟内存区域在被映射文件中的偏移量</li> <li>dev: 03:08 文件的主设备号和次设备号</li> <li>inode: 设备的节点号，0表示没有节点与内存相对应</li> <li>name: /lib/ld-2.3.4.so 被映射文件的文件名</li></ul></li></ul> <h5 id="进程控制块和上下文切换"><a href="#进程控制块和上下文切换" class="header-anchor">#</a> 进程控制块和上下文切换</h5> <ul><li>在内核中，每个进程都通过一个叫做进程控制块（Process Control Block，PCB）的数据结构保存相关状态，如进程标识符（PID），进程状态，虚拟内存状态，打开的文件等等。Linux4.14中的PCB是名为task_struct的结构体</li> <li>进程的上下文（context）：进程运行时的寄存器状态，用于保存和恢复上一个进程在处理器上运行的状态</li> <li>进程上下文切换机制：在进程切换时，将进程的寄存器状态写到待切出进程的PCB中，然后读入待切入进程的PCB，载入到寄存器</li> <li>随着操作系统发展，调度和上下文切换的基本单位从进程变为线程</li></ul> <h4 id="linux的进程操作"><a href="#linux的进程操作" class="header-anchor">#</a> Linux的进程操作</h4> <h5 id="进程的创建-fork"><a href="#进程的创建-fork" class="header-anchor">#</a> 进程的创建：fork</h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>

<span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> O_RDWR<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> rc <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>rc <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 子进程创建失败</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;Fork failed\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>rc <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 子进程</span>
    <span class="token class-name">ssize_t</span> cnt <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Child Process: rc is: %d; The value of x is: %d; str is %s\n&quot;</span><span class="token punctuation">,</span> rc<span class="token punctuation">,</span> x<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">// 父进程</span>
    <span class="token class-name">ssize_t</span> cnt <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Parent Process: rc is: %d; The value of x is: %d; str is %s\n&quot;</span><span class="token punctuation">,</span> rc<span class="token punctuation">,</span> x<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>Parent Process: rc is 8283; The value of x is 42; str is abcdefghij
Child Process: rc is 0; The value of x is 42; str is klmnopqrst
</code></pre></div><ul><li>fork接口不接受任何参数，返回值是当前进程的PID，在子进程中返回值为0</li> <li>当一个进程调用fork时，操作系统会为该进程创建一个几乎一样的新进程，两个进程的内存、寄存器、程序计数器等状态完全一致，但拥有不同的PID和虚拟内存空间，fork完成后独立执行，互不干扰</li> <li>父子进程执行的顺序是不确定的，因为在操作系统调度器的视角下，他们是完全独立的个体</li> <li>子进程在fork的时候拿到父进程的文件描述符（file descriptor, fd）表，所以会指向相同的文件抽象，而Linux在实现read操作时会对文件抽象加锁，故父子进程不会读到相同的字符串；由此可见，fork后父子进程存在大量共享，造成很多不确定行为，POSIX标准列出了调用fork的25中特殊情况的处理方法</li> <li>系统中的第一个进程是操作系统创建，特定且唯一的</li></ul> <h5 id="进程的执行-exec"><a href="#进程的执行-exec" class="header-anchor">#</a> 进程的执行：exec</h5> <ul><li>Linux提供了exec接口用于执行用户指定的二进制文件，其中最全面的是execve，接受三个参数
<ul><li>pathname：进程需要载入的可执行文件路径</li> <li>argv：进程执行所需要的参数（用于给main函数）</li> <li>envp：进程定义的环境变量</li></ul></li></ul> <div class="language- extra-class"><pre class="language-text"><code>#include &lt;unistd.h&gt;
int execve(const char* pathname, char* const argv[], char* const envp[]);
</code></pre></div><ul><li>当execve被调用时，先从可执行文件中载入数据段和代码段到当前进程的地址空间，再重新初始化堆栈，将PC寄存器设置到可执行文件代码段定义的入口点</li></ul> <h5 id="进程管理"><a href="#进程管理" class="header-anchor">#</a> 进程管理</h5> <h6 id="进程树"><a href="#进程树" class="header-anchor">#</a> 进程树</h6> <ul><li>Linux中，由于进程是fork创建的，且每个进程的PCB都记录了父进程和子进程，故构成了进程树结构</li> <li>Linux下有2个特殊的进程：init进程(PID = 1)和kthreadd(PID = 2)</li></ul> <h6 id="进程间监控-wait"><a href="#进程间监控-wait" class="header-anchor">#</a> 进程间监控：wait</h6> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>

<span class="token class-name">pid_t</span> <span class="token function">waitpid</span><span class="token punctuation">(</span><span class="token class-name">pid_t</span> pid<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> wstatus<span class="token punctuation">,</span> <span class="token keyword">int</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>进程可以使用wait操作来对其子进程进行监控，第一个参数是子进程id，第二个参数用于保存子进程状态，若子进程退出，则返回设置wstatus指针对应的值，否则会阻塞等待。</li> <li>若父进程没有调用wait操作，就算子进程已经终止，也不会完全释放资源，内核会为僵尸进程保留其进程描述符（PID）和终止时的信息（wstatus）；当父进程退出时，其创建的僵尸进程都会被内核的第一个进程init通过调用wait的方式回收</li></ul> <h6 id="进程组和会话"><a href="#进程组和会话" class="header-anchor">#</a> 进程组和会话</h6> <ul><li>进程组：进程的集合，由一个或多个进程组成，其作用体现在对信号的处理上，应用程序可以调用killpg向一个进程组发送信号，这个信号会被发送给这个进程组的每个进程</li> <li>会话：进程组的集合，由一个或多个进程组组成，根据执行状态，分为前台进程组、后台进程组</li> <li>控制终端（controlling terminal）进程是会话与外界进行交互的窗口，启用一个终端（shell）对应一个会话</li></ul> <h5 id="fork过时了吗"><a href="#fork过时了吗" class="header-anchor">#</a> fork过时了吗</h5> <ul><li><p>fork的评价</p> <ul><li>优点：
<ul><li>1、设计简洁，和exec组合将进程创建进一步解耦（在fork调用后，exec调用前，对子进程进行各种设定）</li> <li>2、强调了进程间的联系：如同一个shell创建的进程虽然功能不同，但都属于同一个用户，因此可以共享很多状态；又如web服务器可以通过fork创建多个进程应对逻辑相似的用户请求</li></ul></li> <li>缺点：
<ul><li>1、实现复杂：需要考虑特殊情况越来越多以修正父进程与子进程的共享状态问题</li> <li>2、性能太差：尽管写时拷贝技术已经大大提高效率，但在大内存应用的今天，建立内存映射的耗时使得fork不能满足效率需要</li> <li>3、安全隐患：fork建立的父子进程之间的联系可能成为攻击切入点，如BROP攻击</li></ul></li></ul></li> <li><p>fork的替代方案</p> <ul><li>合二为一：posix_spawn：近似为fork和exec的功能结合，性能更佳，灵活度较低</li> <li>限定场景：vfork：从父进程中创建出子进程，但不为子进程创建独立地址空间，而是共享地址空间，一个进程对内存的修改会影响另一进程，为了保证正确性，vfork会在结束后阻塞父进程，直到子进程调用exec或退出为止，在大内存应用程序场景下，性能有提升</li> <li>精密控制：rfork/clone：允许父进程和子进程共享部分特定资源</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;spawn.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">posix_spawn</span><span class="token punctuation">(</span><span class="token class-name">pid_t</span> <span class="token operator">*</span>pid<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token class-name">posix_spawn_file_actions_t</span> <span class="token operator">*</span>file_actions<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token class-name">posix_spawnattr_t</span> <span class="token operator">*</span>attrp<span class="token punctuation">,</span>
               	<span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">const</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">char</span> <span class="token operator">*</span> <span class="token keyword">const</span> envp<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token class-name">pid_t</span> <span class="token function">vfork</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sched.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>fn<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//fn是进程创建完成后需要执行的函数</span>
         	<span class="token keyword">void</span> <span class="token operator">*</span>stack<span class="token punctuation">,</span> <span class="token comment">//子进程栈的位置</span>
         	<span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token comment">// 指定不需要复制的部分</span>
         	<span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">,</span> <span class="token comment">// arg是提供给子进程的参数</span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="线程"><a href="#线程" class="header-anchor">#</a> 线程</h4> <ul><li>随着CPU核心数增加，程序可并行度提高，进程这一抽象太笨重
<ul><li>1、创建进程开销大（独立地址空间，载入数据段代码段，初始化堆栈等）</li> <li>2、进程间数据共享和同步麻烦（共享虚拟内存页粒度过粗，进程间通信开销大）</li></ul></li> <li>线程：进程内部可独立执行的单元，共享地址空间，但各自保存运行时所需状态（上下文）</li></ul> <h5 id="多线程地址空间布局"><a href="#多线程地址空间布局" class="header-anchor">#</a> 多线程地址空间布局</h5> <ul><li>内核栈和用户栈分离，共享除栈外的其他区域</li> <li>malloc的实现需要使用同步原语</li></ul> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gtd4jwk5trj60dp0z2gp202.jpg" style="zoom:33%;"> <h5 id="用户态线程和内核态线程"><a href="#用户态线程和内核态线程" class="header-anchor">#</a> 用户态线程和内核态线程</h5> <ul><li>用户态线程：由应用创建，内核不可见，不直接受操作系统调度器管理，轻量级，与内核态相关的操作需要内核态线程协助完成</li> <li>内核态线程：由内核创建，受操作系统调度器直接管理</li> <li>多线程模型：操作系统会建立的用户态线程和内核态线程的关系，让二者协作，主要有以下三种
<ul><li>多对一：将多个用户态线程映射给单一的内核态线程，每次仅有一个用户态线程进入内核，其他被阻塞，模型较简单</li> <li>一对一：每个用户态线程有对应的内核态线程执行相关逻辑，无需担心阻塞其他线程，创建内核态线程开销随用户态线程增加而增大，故通过限制用户态线程总数来避免性能下降，模型扩展性更好（主流模型，Linux、Windows采用此模型）</li> <li>多对多：将N个用户态线程映射到M个内核态线程中（N &gt; M），M可以设为核心数，缓解了多对一的阻塞问题和一对一的开销问题，但管理起来会更复杂</li></ul></li></ul> <h5 id="线程控制块与线程本地存储"><a href="#线程控制块与线程本地存储" class="header-anchor">#</a> 线程控制块与线程本地存储</h5> <ul><li>线程控制块（TCB）：
<ul><li>主流一对一线程模型中，内核态线程和用户态线程各自保存自己的TCB</li> <li>内核态TCB：存储线程运行状态、内存映射、标识符等信息</li> <li>用户态TCB：内核态TCB的扩展，具体结构由线程库决定，一个重要的功能是线程本地存储</li></ul></li> <li>线程本地存储（Thread Local Storage, TLS）
<ul><li>可定义线程私有全局变量（一个名字，多份拷贝）如：<code>__thread int count;</code></li></ul></li></ul> <h5 id="线程基本接口-以posix线程库为例"><a href="#线程基本接口-以posix线程库为例" class="header-anchor">#</a> 线程基本接口——以POSIX线程库为例</h5> <ul><li>线程创建：pthread_create函数，通过clone函数来实现，创建出一个从属于原进程，共享大量数据结构，拥有私有栈的实例（即对应一个线程）</li> <li>线程退出：pthread_exit函数，会被隐式调用，若如此，线程主函数返回值即线程返回值</li> <li>出让资源：pthread_yield函数，允许线程主动暂停，让出当前CPU给其他线程使用，如等待外部事件时</li> <li>合并操作：pthread_join函数，允许一个线程等待另一个线程的执行，并获取其执行结果</li> <li>挂起与唤醒：使线程挂起（进入阻塞状态）的机制有两种
<ul><li>等待固定时间：sleep函数</li> <li>等待具体事件：pthread_cond_wait函数，使用条件变量作为同步的方式</li> <li>二者结合：pthread_cond_timedwait函数，等待超过固定时间或接受到信号都唤醒线程</li></ul></li> <li>sleep和yield的区别
<ul><li>线程调用sleep后进入阻塞状态，线程调用yield后进入预备状态</li> <li>yield适合等待条件很快被满足的情况，yield可以看作sleep(0)</li></ul></li></ul> <h5 id="chcore中上下文切换的实现"><a href="#chcore中上下文切换的实现" class="header-anchor">#</a> Chcore中上下文切换的实现</h5> <ul><li>进入内核态，保存上下文；切换页表和内核栈；恢复上下文和返回用户态</li></ul> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gte2v7hhrtj61al0dsn1n02.jpg" alt=""></p> <h4 id="纤程"><a href="#纤程" class="header-anchor">#</a> 纤程</h4> <ul><li>背景：
<ul><li>1、与操作系统调度器相比，应用程序对线程的语义和执行状态更了解，能作出更优的调度决策</li> <li>2、用户态线程（纤程，fiber）更轻量级，合理使用有利于提高系统可扩展性</li></ul></li> <li>POSIX的纤程支持</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ucontext.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">getcontext</span><span class="token punctuation">(</span><span class="token class-name">ucontext_t</span> <span class="token operator">*</span>ucp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保存当前上下文</span>
<span class="token keyword">int</span> <span class="token function">setcontext</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">ucontext_t</span> <span class="token operator">*</span>ucp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 切换到另一个上下文</span>
<span class="token keyword">void</span> <span class="token function">makecontext</span><span class="token punctuation">(</span><span class="token class-name">ucontext_t</span> <span class="token operator">*</span>ucp<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>func<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个全新的上下文，并保存在参数ucp中</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">// 一个生产者消费者模型</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ucontext.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token class-name">ucontext_t</span> ucontext1<span class="token punctuation">,</span> ucontext2<span class="token punctuation">;</span>
<span class="token keyword">int</span> current <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  current<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token function">setcontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ucontext2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">consume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;current value: %d \n&quot;</span><span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setcontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ucontext1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 应用程序准备两个上下文的栈</span>
  <span class="token keyword">char</span> func_stack1<span class="token punctuation">[</span>SIGSTKSZ<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> func_stack2<span class="token punctuation">[</span>SIGSTKSZ<span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token function">getcontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ucontext1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ucontext1<span class="token punctuation">.</span>uc_link <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  ucontext1<span class="token punctuation">.</span>uc_stack<span class="token punctuation">.</span>ss_sp <span class="token operator">=</span> func_stack1<span class="token punctuation">;</span>
  ucontext1<span class="token punctuation">.</span>uc_stack<span class="token punctuation">.</span>ss_size <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>func_stack1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">makecontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ucontext1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>produce<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">getcontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ucontext2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ucontext2<span class="token punctuation">.</span>uc_link <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  ucontext2<span class="token punctuation">.</span>uc_stack<span class="token punctuation">.</span>ss_sp <span class="token operator">=</span> func_stack2<span class="token punctuation">;</span>
  ucontext2<span class="token punctuation">.</span>uc_stack<span class="token punctuation">.</span>ss_size <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>func_stack2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">makecontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ucontext2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>consume<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 不需要操作系统调度器的参与，避免上下文切换的开销和调度时间等候间隔</span>
  <span class="token function">setcontext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ucontext1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>操作系统可以通过中断的方式抢占CPU并进行上下文切换，此为抢占式多任务处理</li> <li>纤程库一般提供yield接口，暂时放弃CPU，允许其他纤程调度，此为合作式多任务处理</li> <li>一般程序语言提供的纤程支持称为协程（coroutine），方便应用程序创建和管理轻量级上下文，常用于上下文切换频繁的场景</li></ul> <h2 id="chap6-操作系统调度"><a href="#chap6-操作系统调度" class="header-anchor">#</a> Chap6 操作系统调度</h2> <h4 id="计算机调度简介"><a href="#计算机调度简介" class="header-anchor">#</a> 计算机调度简介</h4> <h5 id="操作系统调度"><a href="#操作系统调度" class="header-anchor">#</a> 操作系统调度</h5> <ul><li>Linux上的htop命令
<ul><li>1、查看系统每个CPU核，内存，交换区占用，当前任务数，线程数</li> <li>2、查看每个进程资源占用，和启动该进程的命令，以及方便的系列功能</li></ul></li></ul> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gte6vnrcbbj613y0npqff02.jpg" alt="image-20210812183810847" style="zoom:50%;"> <ul><li>操作系统的任务调度器通过维护运行队列来管理任务（Linux通过红黑树实现运行队列）</li></ul> <h5 id="调度指标"><a href="#调度指标" class="header-anchor">#</a> 调度指标</h5> <ul><li>性能指标：吞吐量、周转时间（任务从发起到执行结束）、响应时间</li> <li>非性能指标：公平性、资源利用率</li> <li>场景需求：实时性、能耗</li></ul> <h5 id="调度权衡"><a href="#调度权衡" class="header-anchor">#</a> 调度权衡</h5> <ul><li>调度开销与调度效果：合理的调度决策需要大量的计算，耗时变长</li> <li>优先级与公平性：保证高优先级任务优先执行、但不能让低优先级任务执行时间过短</li> <li>性能与能耗：若调度器过分追求性能，使CPU高速运转，则会使电量迅速耗尽</li></ul> <h4 id="调度机制"><a href="#调度机制" class="header-anchor">#</a> 调度机制</h4> <h5 id="长期、中期、短期调度"><a href="#长期、中期、短期调度" class="header-anchor">#</a> 长期、中期、短期调度</h5> <ul><li><p>长期调度：决定系统中真正被短期调度管理的进程数量</p></li> <li><p>中期调度：换页机制的一部分，当系统进程占用了大量内存时，会根据策略挂起系统中被短期调度管理的特定进程（挂起阻塞状态、挂起预备状态，挂起后无法被短期调度），换页机制会倾向选择被挂起的进程的内存页替换入磁盘，并在适当时机重新激活进程</p></li> <li><p>短期调度：负责进程在预备状态、运行状态、阻塞状态间的转换</p></li></ul> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtebkc9xo6j61f40na0yz02.jpg" alt=""></p> <ul><li>长短期调度会考虑CPU、IO，中期调度会考虑内存</li></ul> <h4 id="单核调度策略"><a href="#单核调度策略" class="header-anchor">#</a> 单核调度策略</h4> <h5 id="经典调度"><a href="#经典调度" class="header-anchor">#</a> 经典调度</h5> <table><thead><tr><th>策略名称</th> <th>描述</th> <th>优点</th> <th>缺点</th></tr></thead> <tbody><tr><td>先到先得（First Come First Serve, FCFS）</td> <td>任务的执行顺序与其进入运行队列的顺序一致</td> <td>简单直观</td> <td>1、在长短任务混合场景下对短任务不友好<br>2、对IO密集型任务不友好</td></tr> <tr><td>最短任务优先（Shortest Job First, SJF）</td> <td>调度时选择运行时间最短的任务执行</td> <td>平均周转时间较FCFS短</td> <td>1、任务的运行时间是不可预判的<br>2、表现严重依赖于任务到达时间点</td></tr> <tr><td>最短完成时间任务优先（Shortest Time-to-Completion First, STCF）</td> <td>最短任务优先的抢占式调度版本</td> <td>表现对任务到达时间依赖减少</td> <td>1、长任务难以被调度，公平性不足</td></tr> <tr><td>时间片轮转（Round Robin, RR）</td> <td>任务执行完时间片后，切换到预备队列的下一个任务，若任务未完成，则塞回队尾</td> <td>关注响应时间，提升用户体验</td> <td>1、任务运行时间相似的场景下平均周转时间高<br>2、需要选择合理的时间片值</td></tr></tbody></table> <h5 id="优先级调度"><a href="#优先级调度" class="header-anchor">#</a> 优先级调度</h5> <ul><li><p>调度器应避免交互式任务被批处理任务阻塞，可通过设置优先级来实现</p></li> <li><p>多级队列（Multi-Level Queue, MLQ）</p> <ul><li>描述
<ul><li>每个优先级一个队列</li> <li>一个任务必须等到所有优先级比它高的任务调度完才能被调度</li> <li>处于相同优先级队列的任务，可针对性采用不同调度策略，如FCFS、RR</li></ul></li> <li>评价
<ul><li>适合静态应用场景</li> <li>注意提高IO密集型任务的优先级</li></ul></li> <li>问题
<ul><li>低优先级任务饥饿：需要监控任务等待时间，过长则提升优先级</li> <li>优先级反转：低优先级任务B占了一把锁，导致高优先级任务A无法操作</li></ul></li></ul></li> <li><p>多级反馈队列（Multi-Level Feedback Queue, MLFQ）</p> <ul><li>目标
<ul><li>在无法预知任务信息且任务类型动态变化（CPU密集/IO密集间转换）场景下，既能达到像STCF策略一样的周转时间，又能像RR策略一样降低响应时间</li></ul></li> <li>改良（from MLQ）
<ul><li>1、短任务拥有更高的优先级
<ul><li>默认初始为短任务，最高优先级，若任务在当前队列运行总时间超过阈值，则判定为长任务，优先级降一级</li></ul></li> <li>2、低优先级任务采用更长时间片</li> <li>3、定时将所有任务优先级提到最高
<ul><li>避免饥饿现象</li></ul></li></ul></li> <li>参数
<ul><li>优先级队列数，每个优先级队列的时间片，任务在每个优先级队列的最大运行时间，调度器定时提升优先级的时间间隔</li></ul></li></ul></li></ul> <h5 id="公平共享调度"><a href="#公平共享调度" class="header-anchor">#</a> 公平共享调度</h5> <ul><li>优先级调度是为了优化任务周转时间、响应时间和资源利用率而设计的</li> <li>基于份额的公平调度是为了让每个任务都能使用它应得的系统资源（符合用户预期的）</li></ul> <table><thead><tr><th>调度方法</th> <th>描述</th> <th>优化方法</th> <th>潜在问题</th></tr></thead> <tbody><tr><td>彩票调度</td> <td>任务份额作为其被调度的概率，使用随机数模拟</td> <td>1、彩票转让：将自己的份额借给别的任务，解决锁类的优先级反转问题<br>2、彩票货币：用户或任务组分配份额给子任务时，采用自己的计算方式，提高灵活性<br>3、彩票通胀：给任务一定自由度，允许任务根据当前对CPU资源需求决定自己的份额</td> <td>1、随机数模拟公平调度器的公平性只有在调度次数足够多才有效</td></tr> <tr><td>步幅调度</td> <td>任务每次调度时增加一定的虚拟时间（步幅），每次调度时选择虚拟时间最少的任务去运行，那么经历相同虚拟时间的任务，任务的份额之比对应任务步幅的倒数之比（确定性公平共享调度策略）</td> <td></td> <td>1、任务可能在任意时间进入系统，任务的初始虚拟时间pass应设置为当前所有任务的最小pass值</td></tr></tbody></table> <h5 id="实时调度"><a href="#实时调度" class="header-anchor">#</a> 实时调度</h5> <ul><li>实时任务分类
<ul><li>硬实时任务/软实时任务：是否必须都在截止时间前完成</li> <li>周期任务/偶发任务/非周期任务：确定性周期，具有下界不确定周期（一般硬实时），完全随机（一般软实时）</li></ul></li> <li>实时任务调度存在性判断
<ul><li>设有<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span></span>个任务，任务<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span></span>的运行时间是<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="2.283ex" height="1.952ex" viewBox="0 -705 1009 862.8" style="vertical-align:-0.357ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mi" transform="translate(715, -150) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container>，周期是 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.889ex" viewBox="0 -677 878 834.8" style="vertical-align:-0.357ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(584, -150) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container>，则单位时间CPU利用率为 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="10.336ex" height="5.449ex" viewBox="0 -1362.5 4568.3 2408.5" style="vertical-align:-2.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(1044.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="munderover" transform="translate(2100.6, 0)"><g data-mml-node="mo" transform="translate(45.8, 0)"><path data-c="2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"></path></g><g data-mml-node="TeXAtom" transform="translate(0, -887.9) scale(0.707)"><g data-mml-node="mi"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(345, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1123, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="TeXAtom" transform="translate(263.4, 950) scale(0.707)"><g data-mml-node="mi"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mfrac" transform="translate(3414.9, 0)"><g data-mml-node="msub" transform="translate(220, 451.6) scale(0.707)"><g data-mml-node="mi"><path data-c="43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mi" transform="translate(715, -150) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="msub" transform="translate(266.3, -345) scale(0.707)"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(584, -150) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><rect width="913.4" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></li> <li>若 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="5.884ex" height="1.636ex" viewBox="0 -683 2600.6 723" style="vertical-align:-0.09ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(1044.8, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mn" transform="translate(2100.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container>，则说明不存在这样的实时调度</li></ul></li> <li>面向周期任务的实时调度算法（简化假设：周期和截止时间一致，任务具有独立性）
<ul><li>速率单调（RM）：
<ul><li>基于静态优先级的实时调度策略中的最优（静态：即预知任务列表和每个任务周期<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span></span></span></span></span>）</li> <li>抢占式优先调度 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span></span></span></span></span> 较小的任务</li> <li>调度<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></span>个任务时，最坏情况下CPU利用率为 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="6.056ex" height="3.182ex" viewBox="0 -877 2676.6 1406.6" style="vertical-align:-1.198ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mi" transform="translate(1024.3, 394) scale(0.707)"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mrow" transform="translate(220, -471.7) scale(0.707)"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(500, 363) scale(0.707)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="TeXAtom" transform="translate(500, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g></g></g><g data-mml-node="mo" transform="translate(1885, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(2663, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><rect width="2436.6" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container>，当 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="7.791ex" height="1.57ex" viewBox="0 -683 3443.6 694" style="vertical-align:-0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(1165.8, 0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(2443.6, 0)"><path data-c="221E" d="M55 217Q55 305 111 373T254 442Q342 442 419 381Q457 350 493 303L507 284L514 294Q618 442 747 442Q833 442 888 374T944 214Q944 128 889 59T743 -11Q657 -11 580 50Q542 81 506 128L492 147L485 137Q381 -11 252 -11Q166 -11 111 57T55 217ZM907 217Q907 285 869 341T761 397Q740 397 720 392T682 378T648 359T619 335T594 310T574 285T559 263T548 246L543 238L574 198Q605 158 622 138T664 94T714 61T765 51Q827 51 867 100T907 217ZM92 214Q92 145 131 89T239 33Q357 33 456 193L425 233Q364 312 334 337Q285 380 233 380Q171 380 132 331T92 214Z"></path></g></g></g></svg></mjx-container> 时，其值约为69%，即一组任务的<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span></span></span></span></span>值若低于此，则RM策略能提供合法的调度</li></ul></li> <li>最早截止时间有限（EDF）
<ul><li>单核抢占式场景，任务互相无关下，EDF是基于动态优先级策略中的理论最优</li> <li>抢占式优先调度截止时间最近的任务（无需知道周期、运行时间等信息）</li> <li>对于<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="5.884ex" height="1.857ex" viewBox="0 -683 2600.6 821" style="vertical-align:-0.312ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(1044.8, 0)"><path data-c="2264" d="M674 636Q682 636 688 630T694 615T687 601Q686 600 417 472L151 346L399 228Q687 92 691 87Q694 81 694 76Q694 58 676 56H670L382 192Q92 329 90 331Q83 336 83 348Q84 359 96 365Q104 369 382 500T665 634Q669 636 674 636ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path></g><g data-mml-node="mn" transform="translate(2100.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container>的任务组，EDF策略能提供合法的调度</li> <li>在<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="5.884ex" height="1.857ex" viewBox="0 -683 2600.6 821" style="vertical-align:-0.312ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(1044.8, 0)"><path data-c="2264" d="M674 636Q682 636 688 630T694 615T687 601Q686 600 417 472L151 346L399 228Q687 92 691 87Q694 81 694 76Q694 58 676 56H670L382 192Q92 329 90 331Q83 336 83 348Q84 359 96 365Q104 369 382 500T665 634Q669 636 674 636ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path></g><g data-mml-node="mn" transform="translate(2100.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container>时，是最优实时调度策略；但<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="5.884ex" height="1.636ex" viewBox="0 -683 2600.6 723" style="vertical-align:-0.09ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(1044.8, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mn" transform="translate(2100.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container>时，会因一个任务错过截止时间而带来大量后续任务错过截止时间的多米诺效应</li></ul></li></ul></li></ul> <h5 id="通用调度"><a href="#通用调度" class="header-anchor">#</a> 通用调度</h5> <ul><li><p>借用虚拟时间（BVT）</p> <ul><li><p>整合步幅调度和优先级调度，既保证了公平共享调度又保证了实时任务的实时性</p></li> <li><p>对于需要尽快完成的任务，BVT策略允许任务将自己的pass值降低，以达到被优先调用的目的</p></li> <li><p>调度器根据通过实际生效的虚拟时间来选取下一个调度的任务</p> <ul><li><mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="61.339ex" height="2.364ex" viewBox="0 -750 27112 1045" style="vertical-align:-0.667ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(769, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1114, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1565, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1926, 0)"><path data-c="75" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2498, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3027, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(3325, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(4029, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(4374, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="msub" transform="translate(5252, 0)"><g data-mml-node="mi"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="TeXAtom" transform="translate(466, -150) scale(0.707)"><g data-mml-node="mi"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(466, 0)"><path data-c="66" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mi" transform="translate(1016, 0)"><path data-c="66" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mi" transform="translate(1566, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(2032, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(2465, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(2826, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3171, 0)"><path data-c="76" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(3656, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g></g></g><g data-mml-node="mo" transform="translate(8960.5, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(10016.2, 0)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(10785.2, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(11130.2, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(11491.2, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(11942.2, 0)"><path data-c="75" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(12514.2, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(13043.2, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(13341.2, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(14045.2, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(14390.2, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="msub" transform="translate(15268.2, 0)"><g data-mml-node="mi"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="TeXAtom" transform="translate(466, -152.7) scale(0.707)"><g data-mml-node="mi"><path data-c="41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mi" transform="translate(750, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(1183, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1544, 0)"><path data-c="75" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2116, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(2645, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g><g data-mml-node="mo" transform="translate(18087.5, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mo" transform="translate(19087.7, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(19476.7, 0)"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mi" transform="translate(20225.7, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(20523.7, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="msub" transform="translate(21052.7, 0)"><g data-mml-node="mi"><path data-c="67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(477, -150) scale(0.707)"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1048, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1499, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(2028, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g><g data-mml-node="mtext" transform="translate(23369.4, 0)"><path data-c="A0" d=""></path></g><g data-mml-node="mo" transform="translate(23619.4, 0)"><path data-c="3F" d="M226 668Q190 668 162 656T124 632L114 621Q116 621 119 620T130 616T145 607T157 591T162 567Q162 544 147 529T109 514T71 528T55 566Q55 625 100 661T199 704Q201 704 210 704T224 705H228Q281 705 320 692T378 656T407 612T416 567Q416 503 361 462Q267 395 247 303Q242 279 242 241V224Q242 205 239 202T222 198T205 201T202 218V249Q204 320 220 371T255 445T292 491T315 537Q317 546 317 574V587Q317 604 315 615T304 640T277 661T226 668ZM162 61Q162 89 180 105T224 121Q247 119 264 104T281 61Q281 31 264 16T222 1Q197 1 180 16T162 61Z"></path></g><g data-mml-node="mtext" transform="translate(24091.4, 0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(24341.4, 0)"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mo" transform="translate(25667.2, 0)"><path data-c="3A" d="M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mn" transform="translate(26223, 0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(26723, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></li></ul></li> <li><p>新任务、处于阻塞状态中的任务可能在任意时间进入系统，故其虚拟时间需要在进入系统时被重新设置</p> <ul><li><mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="50.496ex" height="2.262ex" viewBox="0 -750 22319.3 1000" style="vertical-align:-0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(769, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1114, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1565, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1926, 0)"><path data-c="75" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2498, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3027, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(3325, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(4029, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(4374, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="msub" transform="translate(5252, 0)"><g data-mml-node="mi"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="TeXAtom" transform="translate(466, -152.7) scale(0.707)"><g data-mml-node="mi"><path data-c="41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mi" transform="translate(750, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(1183, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1544, 0)"><path data-c="75" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2116, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(2645, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g><g data-mml-node="mo" transform="translate(8126.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(9182.6, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(10060.6, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(10589.6, 0)"><path data-c="78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(11161.6, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(11550.6, 0)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(12319.6, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(12664.6, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(13115.6, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(13476.6, 0)"><path data-c="75" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(14048.6, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(14577.6, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(14875.6, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(15579.6, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(15924.6, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="msub" transform="translate(16802.6, 0)"><g data-mml-node="mi"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="TeXAtom" transform="translate(466, -152.7) scale(0.707)"><g data-mml-node="mi"><path data-c="41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mi" transform="translate(750, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(1183, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1544, 0)"><path data-c="75" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2116, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(2645, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g><g data-mml-node="mo" transform="translate(19399.6, 0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(19844.3, 0)"><path data-c="53" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mi" transform="translate(20457.3, 0)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(21226.3, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mo" transform="translate(21930.3, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></li> <li><mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="4.719ex" height="1.645ex" viewBox="0 -705 2086 727" style="vertical-align:-0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="53" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mi" transform="translate(613, 0)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(1382, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g></svg></mjx-container>：Scheduler Vitrual Time，表示调度器中所有处于非阻塞和阻塞状态任务的最小VirtualTime_Actual</li></ul></li> <li><p>防止恶意任务无端借用未来虚拟时间的措施</p> <ul><li>1、限制任务最大可借用的虚拟时间量</li> <li>2、任务在一定物理时间后必须将借用的虚拟时间归还，并将Flag_wrap置为False</li></ul></li> <li><p>例子</p> <ul><li><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtk6dh1a5jj61d60t07bv02.jpg" alt=""></li></ul></li></ul></li></ul> <h4 id="多核调度策略"><a href="#多核调度策略" class="header-anchor">#</a> 多核调度策略</h4> <h5 id="负载分担"><a href="#负载分担" class="header-anchor">#</a> 负载分担</h5> <ul><li>描述：多核共享一个全局运行队列，当一个CPU核心需要执行任务时，根据任意单核调度策略，决定从全局运行队列中下一个由它执行的任务</li> <li>优点：
<ul><li>1、设计实现简单、将多核调度问题规约为单核调度问题</li> <li>2、不会出现CPU资源浪费的情况</li></ul></li> <li>问题：
<ul><li>1、多核之间的同步问题可能导致调度开销变得不可忽视</li> <li>2、任务在多个CPU核心间来回切换的开销（RR策略下，会出现大量开销，如重新载入缓存、刷新TLB等）</li></ul></li></ul> <h5 id="协同调度"><a href="#协同调度" class="header-anchor">#</a> 协同调度</h5> <ul><li>场景：多线程程序为了利用多核处理器，通常将大任务切成多个子任务，交给不同的CPU核心运行，但子任务之间可能存在依赖关系（不能同时执行）或关联关系（最好同时执行）</li> <li>描述：尽可能让一组任务并行执行，避免同时调度有依赖关系的两组任务，避免关联任务执行效率降低的情况（通信开销），与并行计算中的整体同步并行计算（BSP）模型契合</li> <li>群组调度：
<ul><li>思想：将关联任务设置为一组，以组为单位调度任务在多个CPU核心上执行，使它们的开始时间和结束时间接近相同</li> <li>优点：提升特定应用场景任务执行性能，但因为要求无关联的任务必须同时进入或退出CPU核心，无关联任务之间的互相等待可能造成CPU资源的浪费</li> <li><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtk6qvt9xjj617t0jp42n02.jpg" style="zoom:25%;"></li></ul></li></ul> <h5 id="两级调度"><a href="#两级调度" class="header-anchor">#</a> 两级调度</h5> <ul><li><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtk6ot1pp8j61e10omdmq02.jpg" style="zoom:25%;"></li> <li><p>线程无须在CPU核心间来回切换，提高缓存局部性，减少数据竞争的冲突</p></li></ul> <h5 id="负载追踪与负载均衡"><a href="#负载追踪与负载均衡" class="header-anchor">#</a> 负载追踪与负载均衡</h5> <ul><li><p>负载追踪</p> <ul><li>运行队列粒度的负载追踪：Linux3.8前，认为运行队列长则负载高，但任务迁移时由于缺乏每个任务的信息，故无法选出合适的任务迁移</li> <li>调度实体粒度的负载追踪（PELT）：Linux3.8后，PELT通过记录每个任务的历史执行情况来表示任务的当前负载，调度器以1024微秒为一个周期，记录任务处于可运行状态的时间为x微秒，则第i个周期内对当前CPU利用率为 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="6.95ex" height="2.262ex" viewBox="0 -750 3072 1000" style="vertical-align:-0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="TeXAtom" transform="translate(572, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mn" transform="translate(1072, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(1000, 0)"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(1500, 0)"></path></g></g></g></svg></mjx-container>，对应的CPU负载 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="2.206ex" height="1.902ex" viewBox="0 -683 975 840.8" style="vertical-align:-0.357ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="4C" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g><g data-mml-node="mi" transform="translate(681, -150) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container> = CPU容量常数 * CPU利用率；任务负载随着时间动态变化，使用$ L' = yL + L_i$，进而统计出每个运行队列的负载</li></ul></li> <li><p>负载均衡</p> <ul><li><p>基本思想：通过追踪每个CPU核心当前的负载情况，将处于高负载的CPU核心管理的任务迁移到低负载的CPU核心上</p></li> <li><p>基本要求：负载均衡决策开销尽量小，且让任务尽量在迁移开销小的CPU核心间迁移</p></li> <li><p>例子：非一致内存访问（Non-Uniform Memory Access, NUMA）的多核处理器系统架构</p> <ul><li><p>结构：NUMA域-&gt;物理域-&gt;逻辑域</p></li> <li><p>特性：</p> <ul><li>1、numa节点拥有本地内存，访问其他numa节点的远端内存时，时延高于访问本地内存</li> <li>2、任务在同属于一个物理核的逻辑核间切换的开销比在不同物理核之间切换小很多</li></ul></li> <li><p>方法：调度域是拥有相同特性的CPU核心的集合，包含多个调度组；调度组是一个调度域内进行负载均衡的整体单位，每个CPU核心都维护一份只读的调度域和调度组数据拷贝。Linux通过自下而上的方式实现负载均衡，越高层级调度域间的负载均衡的开销越大，故Linux对不同层级的调度域设置了不同的负载均衡触发频率与阈值，减少负载均衡开销</p></li> <li><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtk6ndxzz9j60wm0ogjwi02.jpg" style="zoom:33%;"></li></ul></li></ul></li></ul> <h5 id="能耗感知调度-energy-aware-scheduling-eas"><a href="#能耗感知调度-energy-aware-scheduling-eas" class="header-anchor">#</a> 能耗感知调度（Energy Aware Scheduling，EAS）</h5> <ul><li><p>Linux当前使用的EAS调度器是在完全公平调度器（CFS）基础上扩展的，通过能耗模型了解每个CPU核心的容量（处理能力）和功率</p> <ul><li>容量：在特定频率下的处理能力，被标准化到0-1024，</li> <li>功率：在特定频率下的功率，结合任务完成所需的时间计算出能耗
<ul><li>能耗 = 任务负载 * 容量 / 功率，比较大小核的能耗决定在何处运行；也可以调节频率获取不同的容量功率参数组合（操作性能点OPP）</li></ul></li></ul></li> <li><p>EAS做出调度决策时，会选取每个性能域中剩余容量最大的CPU核心作为任务迁移备选，且计算出任务迁移后的总能耗，选取总能耗最低的CPU核心作为任务迁移目标</p></li> <li><p>例子</p> <table><thead><tr><th>大核（PD0，core0+core1）</th> <th></th> <th>小核（PD1，core2+core3）</th> <th></th></tr></thead> <tbody><tr><td>容量</td> <td>功率</td> <td>容量</td> <td>功率</td></tr> <tr><td>384</td> <td>300</td> <td>128</td> <td>80</td></tr> <tr><td>768</td> <td>900</td> <td>256</td> <td>180</td></tr> <tr><td>1024</td> <td>1800</td> <td>512</td> <td>440</td></tr></tbody></table> <ul><li><p>当前负载情况为core0：700，core1：500，core2：300，core3：100</p></li> <li><p>大核运行模式为1024/1800，小核运行模式为512/440，总能耗为1750</p></li> <li><p>EAS决定调度core2上负载为100的任务，调动到core3时，会使小核进入256/180模式，从而总能耗为1688，最小，故采用此调度决策</p></li></ul></li> <li><p>EAS适用于中低负载场景，因为在高负载场景下，两核都按最大模式运行，且缺乏迁移空间，此时Linux会关闭EAS并打开负载均衡；当负载下降时，Linux会关闭负载均衡而重新打开EAS</p></li></ul> <h4 id="调度进阶机制"><a href="#调度进阶机制" class="header-anchor">#</a> 调度进阶机制</h4> <ul><li>操作系统为应用程序提供接口，可帮助有经验的开发者设定自己程序的调度行为</li></ul> <h5 id="处理器亲和性"><a href="#处理器亲和性" class="header-anchor">#</a> 处理器亲和性</h5> <ul><li>处理器亲和性机制（processor affinity）：允许程序对任务可以使用的CPU核心进行配置</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sched.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">CPU_ZERO</span><span class="token punctuation">(</span><span class="token class-name">cpu_set_t</span> <span class="token operator">*</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对set进行初始化，设置为空</span>
<span class="token keyword">void</span> <span class="token function">CPU_SET</span><span class="token punctuation">(</span><span class="token keyword">int</span> cpu<span class="token punctuation">,</span> <span class="token class-name">cpu_set_t</span> <span class="token operator">*</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将对应CPU核心加入set中</span>
<span class="token keyword">void</span> <span class="token function">CPU_CLR</span><span class="token punctuation">(</span><span class="token keyword">int</span> cpu<span class="token punctuation">,</span> <span class="token class-name">cpu_set_t</span> <span class="token operator">*</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将对应的CPU核心从set中删除</span>
<span class="token keyword">int</span> <span class="token function">CPU_ISSET</span><span class="token punctuation">(</span><span class="token keyword">int</span> cpu<span class="token punctuation">,</span> <span class="token class-name">cpu_set_t</span> <span class="token operator">*</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//判断对应CPU核心是否在set中，是则返回1，否则返回0</span>
<span class="token keyword">int</span> <span class="token function">CPU_COUNT</span><span class="token punctuation">(</span><span class="token class-name">cpu_set_t</span> <span class="token operator">*</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回当前set中的CPU核心数量</span>

<span class="token keyword">int</span> <span class="token function">sched_setaffinity</span><span class="token punctuation">(</span><span class="token class-name">pid_t</span> pid<span class="token punctuation">,</span> <span class="token class-name">size_t</span> cpusetsize<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token class-name">cpu_set_t</span> <span class="token operator">*</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//pid为Linux分配的线程标识符，0代表当前线程</span>
<span class="token keyword">int</span> <span class="token function">sched_getaffinity</span><span class="token punctuation">(</span><span class="token class-name">pid_t</span> pid<span class="token punctuation">,</span> <span class="token class-name">size_t</span> cpusetsize<span class="token punctuation">,</span> <span class="token class-name">cpu_set_t</span> <span class="token operator">*</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sched.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/sysinfo.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">cpu_set_t</span> mask<span class="token punctuation">;</span>
    <span class="token function">CPU_ZERO</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">CPU_SET</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">CPU_SET</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sched_setaffinity</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="调度策略配置"><a href="#调度策略配置" class="header-anchor">#</a> 调度策略配置</h5> <ul><li>Linux提供多种调度策略和调度器，允许程序根据不同场景进行选择，包括完全公平调度器（CFS），实时调度器（RT），截止时间调度器（DL），也支持对不同的任务设置不同调度策略</li> <li>Linux会优先调度DL管理器的任务，其次RT、最后是CFS，非实时任务的优先级必须设置为0，实时任务的优先级是[1,100)</li></ul> <table><thead><tr><th>调度器</th> <th>调度策略</th> <th>描述</th></tr></thead> <tbody><tr><td>CFS</td> <td>SCHED_OTHER</td> <td>公平的分时调度策略</td></tr> <tr><td>CFS</td> <td>SCHED_BATCH</td> <td>针对不会与用户交互的批处理任务</td></tr> <tr><td>CFS</td> <td>SCHED_IDLE</td> <td>针对优先级最低的后台任务</td></tr> <tr><td>RT</td> <td>SCHED_FIFO</td> <td>执行直至结束或被更高优先级任务抢占</td></tr> <tr><td>RT</td> <td>SCHED_RR</td> <td>执行一定时间片后不再执行</td></tr> <tr><td>DL</td> <td>SCHED_DEADLINE</td> <td>类似EDF</td></tr></tbody></table> <h4 id="案例分析-现代调度器"><a href="#案例分析-现代调度器" class="header-anchor">#</a> 案例分析——现代调度器</h4> <h5 id="linux调度器"><a href="#linux调度器" class="header-anchor">#</a> Linux调度器</h5> <ul><li>Linux2.4之前，调度器是基于RR策略的运行队列</li> <li>Linux2.4引入了O(n)调度器，选取所有任务中动态优先级最高的任务进行调度，每次调度都需要重新计算队列内所有元素，但此设计调度开销过大，且多核扩展性差，缓存局部性也会受到影响</li> <li>Linux2.6引入了O(1)调度器，采用了两级调度的思想，每个本地运行队列实际上由两个多级队列，激活队列和过期队列组成，分别用于管理仍有时间片剩余的任务和时间片耗尽的任务，若当前激活队列无可调度任务，则交换这两个队列的角色；每个多级队列有140个优先级，0~100对应实时任务，100-140对应不同Nicess的非实时任务；每个多级队列维护一个位图，用于判断对应的优先级队列是否有任务等待调度，调度器能根据位图找到激活队列中首个不为空队列并取队头调度，故时间复杂度为O(1)，但此设计仍存在弊端如下：1、交互式任务的判定算法过于复杂；2、静态时间片带来的调度时延问题</li> <li>Linux2.6.23引入了完全公平调度器（CFS），具有动态时间片特性，使用红黑树作为运行队列，阻塞任务唤醒调整虚拟时间的机制</li></ul> <h5 id="macos-ios调度器"><a href="#macos-ios调度器" class="header-anchor">#</a> macOS/iOS调度器</h5> <ul><li>面向用户体验的调度器GCD，使用公共线程池的方式管理线程，队列需要执行任务时，从线程池中选择一个空闲线程执行；GCD采用基于优先级的实时调度策略，使用QoS等级作为任务优先级（UserInteractive、UserInitiated、Default、Utility、Background），对应五个不同的优先级队列</li></ul> <h2 id="chap7-进程间通信"><a href="#chap7-进程间通信" class="header-anchor">#</a> Chap7 进程间通信</h2> <ul><li>多进程协作具有三点优势：功能模块化避免造轮子，增强模块间隔离提供安全保障，提高应用容错能力</li></ul> <h4 id="进程间通信基础"><a href="#进程间通信基础" class="header-anchor">#</a> 进程间通信基础</h4> <h5 id="数据传递方式"><a href="#数据传递方式" class="header-anchor">#</a> 数据传递方式</h5> <ul><li>基于共享内存的信消息传递：多个进程在虚拟地址空间中映射了同一段物理内存，操作系统不参与后续通信过程</li> <li>操作系统辅助的消息传递：内核对用户态提供通信接口，进程可以直接使用Send，Recv等接口将消息传递给另一进程</li></ul> <h5 id="控制流转移"><a href="#控制流转移" class="header-anchor">#</a> 控制流转移</h5> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtna9yswhrj61bw0kd7c302.jpg" alt=""></p> <h5 id="同步和异步"><a href="#同步和异步" class="header-anchor">#</a> 同步和异步</h5> <ul><li>同步IPC指IPC操作会阻塞进程直至操作完成；异步IPC是非阻塞的，不需要等待完成</li> <li>同步IPC有着更好的编程抽象，但高并发场景下，过少的工作线程会让大量用户进程被阻塞、过多的工作线程会浪费系统资源</li></ul> <h4 id="宏内核进程间通信"><a href="#宏内核进程间通信" class="header-anchor">#</a> 宏内核进程间通信</h4> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gtne91e244j60t90zz7cf02.jpg" style="zoom:50%;"> <h5 id="微内核进程间通信"><a href="#微内核进程间通信" class="header-anchor">#</a> 微内核进程间通信</h5> <ul><li><p>Mach：通过进程间通信来传送端口，同步通信，由内核负责控制流的转移</p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gtnew5rrm4j616a0fhn0q02.jpg" style="zoom:50%;"></li> <li><p>L4：长短消息的传递使用不同方式</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtnews9idxj618q0gijvu02.jpg" alt=""></p></li> <li><p>LRPC：轻量级远程过程调用（迁移线程模型）</p> <ul><li>在IPC过程中，内核不会阻塞调用者线程，但会让调用者线程执行被调用者的代码，不会唤醒被调用者线程，内核不会进行完整的上下文切换，仅切换地址空间和请求处理相关的系统状态，不会涉及线程和优先级切换，不会调用调度器</li> <li>迁移线程方案简化了控制流切换，通过共享参数栈和寄存器简化了数据传输，避免全局共享数据结构来优化并发</li></ul></li></ul> <h4 id="案例分析-android-binder、chcore"><a href="#案例分析-android-binder、chcore" class="header-anchor">#</a> 案例分析：Android Binder、Chcore</h4> <ul><li>Android Binder IPC机制相比于Linux的通信机制，在性能、接口易用性上有提升
<ul><li>大部分进程间通信实际上是远程过程调用，是同步的；客户端进程通过进程间通信发起请求，服务端进程负责提供具体服务，接受请求，返回结果。</li> <li>Context Manager进程提供命名服务，任务是建立通信连接</li> <li>句柄是IPC对象（一个通信连接）的抽象，用户通过操作句柄完成IPC</li> <li>使用线程池模型
*</li> <li>匿名共享内存
<ul><li>1、进程1打开匿名共享内存对应的字符设备</li> <li>2、设置内存段的大小</li> <li>3、通过mmap映射文件的方式，将创建的匿名共享内存映射到用户态空间</li> <li>4、进程1使用进程间通信传递文件描述符给进程2，以快速传递大量数据</li></ul></li></ul></li></ul> <h2 id="chap8-同步原语"><a href="#chap8-同步原语" class="header-anchor">#</a> Chap8 同步原语</h2> <h4 id="互斥锁"><a href="#互斥锁" class="header-anchor">#</a> 互斥锁</h4> <h5 id="临界区问题"><a href="#临界区问题" class="header-anchor">#</a> 临界区问题</h5> <ul><li>竞争冒险：程序的正确性依赖于特定执行顺序的情况，其本质原因是对于共享资源的竞争</li> <li>互斥访问：任意时刻只允许最多一个线程访问的方式</li> <li>临界区：保证互斥访问共享资源的代码区域</li> <li>临界区问题：如何通过设计协议保证互斥访问临界区的问题，需要满足互斥访问、有限等待、空闲让进三个条件</li></ul> <h5 id="硬件实现-关闭中断"><a href="#硬件实现-关闭中断" class="header-anchor">#</a> 硬件实现：关闭中断</h5> <ul><li>单核环境下，关闭中断可以满足互斥访问、有限等待、空闲让进三个条件；但多核环境下，互斥访问不满足</li></ul> <h5 id="软件实现-皮特森算法"><a href="#软件实现-皮特森算法" class="header-anchor">#</a> 软件实现：皮特森算法</h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">// 线程 x (x=0,1)</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">{</span>
  flag<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> true<span class="token punctuation">;</span>
  turn <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">-</span>x<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">-</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> true <span class="token operator">&amp;&amp;</span> turn <span class="token operator">==</span> <span class="token number">1</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 临界区部分</span>
  flag<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> false<span class="token punctuation">;</span>
  <span class="token comment">// 其他代码</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Micha Hofri在1990年将皮特森算法扩展为任意数量线程，但皮特森算法要求访存操作严格按照程序顺序执行，但现代CPU允许乱序访存以获取高性能，故皮特森算法无法直接使用</li></ul> <h5 id="软硬件协同-使用原子操作实现互斥锁"><a href="#软硬件协同-使用原子操作实现互斥锁" class="header-anchor">#</a> 软硬件协同：使用原子操作实现互斥锁</h5> <ul><li><p>原子操作：不可被打断的一个或一系列操作，常见的包括比较与置换（CAS），拿取并累加（FAA），这些是硬件保证的</p></li> <li><p>互斥锁：</p> <ul><li><p>利用原子CAS实现的自旋锁</p> <ul><li>利用一个变量lock来表示锁的状态，1表示有人拿锁，0表示锁空闲</li> <li>加锁时会通过CAS判断lock是否空闲，若空闲则上锁，否则一遍遍重试；放锁时直接将lock值设为0</li> <li>自旋锁并不能保证有限等待，原子操作成功与否取决于硬件特性，自旋锁在竞争程度低时非常高效</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">lock_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>lock<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token operator">*</span>lock <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>lock<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">atomic_CAS</span><span class="token punctuation">(</span>lock<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>lock<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token operator">*</span>lock <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>利用原子FAA实现的排号自旋锁</p> <ul><li>排号锁按照锁竞争者申请锁的顺序传递锁，保证有限等待的公平性</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">lock</span> <span class="token punctuation">{</span>
	<span class="token keyword">volatile</span> <span class="token keyword">int</span> owner<span class="token punctuation">;</span>
  <span class="token keyword">volatile</span> <span class="token keyword">int</span> next<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">lock_init</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">lock</span> <span class="token operator">*</span>lock<span class="token punctuation">)</span><span class="token punctuation">{</span>
  lock<span class="token operator">-&gt;</span>owner <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  lock<span class="token operator">-&gt;</span>next <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">lock</span> <span class="token operator">*</span>lock<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">volatile</span> <span class="token keyword">int</span> my_ticket <span class="token operator">=</span> <span class="token function">atomic_FAA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token operator">-&gt;</span>next<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>lock<span class="token operator">-&gt;</span>owner <span class="token operator">!=</span> my_ticket<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">lock</span> <span class="token operator">*</span>lock<span class="token punctuation">)</span><span class="token punctuation">{</span>
  lock<span class="token operator">-&gt;</span>owner<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h4 id="条件变量"><a href="#条件变量" class="header-anchor">#</a> 条件变量</h4> <ul><li><p>条件变量通过提供挂起/唤醒机制来避免循环等待，节省CPU资源，条件变量需要和互斥锁搭配使用</p></li> <li><p>条件变量提供两个接口</p> <ul><li>cond_wait：挂起当前线程
<ul><li>1、将当前线程加入等待队列</li> <li>2、原子地挂起当前线程并放锁 atomic_block_unlock
<ul><li>若先放锁，再挂起，则在间隙间接受到唤醒信号时，无法被唤醒，导致挂起后再也无法被唤醒，出错</li> <li>若先挂起，则无法放锁</li></ul></li></ul></li> <li>cond_signal：唤醒等待在该条件变量上的线程（一般在临界区内使用）</li></ul></li> <li><p>条件变量的实现</p></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">cond</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">thread</span> <span class="token operator">*</span>wait_list<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">cond_wait</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">cond</span> <span class="token operator">*</span>cond<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">lock</span> <span class="token operator">*</span>mutex<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">list_append</span><span class="token punctuation">(</span>cond<span class="token operator">-&gt;</span>wait_list<span class="token punctuation">,</span> <span class="token function">thread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">atomic_block_unlock</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 原子挂起并放锁</span>
  <span class="token function">lock</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重新获取互斥锁</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">cond_signal</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">cond</span> <span class="token operator">*</span>cond<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>list<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span>cond<span class="token operator">-&gt;</span>wait_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">wakeup</span><span class="token punctuation">(</span><span class="token function">list_remove</span><span class="token punctuation">(</span>cond<span class="token operator">-&gt;</span>wait_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">cond_broadcast</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">cond</span> <span class="token operator">*</span>cond<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>list<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span>cond<span class="token operator">-&gt;</span>wait_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">wakeup</span><span class="token punctuation">(</span><span class="token function">list_remove</span><span class="token punctuation">(</span>cond<span class="token operator">-&gt;</span>wait_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="信号量"><a href="#信号量" class="header-anchor">#</a> 信号量</h4> <ul><li>信号量，又称PV原语，在不同的线程之间充当信号灯，根据剩余资源数量控制不同线程的执行与等待，一般使用wait和signal对应P操作和V操作
<ul><li>wait操作：在信号量的值小于等于0时进入循环等待，大于0时停止等待并消耗该资源</li> <li>signal操作：增加信号量的值供wait的线程使用</li></ul></li> <li>信号量是由互斥锁、条件变量、计数器共同实现的</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">sem</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> value<span class="token punctuation">;</span>
  <span class="token keyword">int</span> wakeup<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">lock</span> sem_lock<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">cond</span> sem_cond<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sem</span> <span class="token operator">*</span>S<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>S<span class="token operator">-&gt;</span>sem_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
  S<span class="token operator">-&gt;</span>value<span class="token operator">--</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>S<span class="token operator">-&gt;</span>value <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
      <span class="token function">cond_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>S<span class="token operator">-&gt;</span>sem_cond<span class="token punctuation">,</span> <span class="token operator">&amp;</span>S<span class="token operator">-&gt;</span>sem_lock<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//do-while确保调用signal后立刻调用wait的线程不会直接拿走资源</span>
    <span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span>S<span class="token operator">-&gt;</span>wakeup <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  	S<span class="token operator">-&gt;</span>wakeup<span class="token operator">--</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
  <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>S<span class="token operator">-&gt;</span>sem_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">signal</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sem</span> <span class="token operator">*</span>S<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>S<span class="token operator">-&gt;</span>sem_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
  S<span class="token operator">-&gt;</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>S<span class="token operator">-&gt;</span>value <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    S<span class="token operator">-&gt;</span>wakeup<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">cond_signal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>S<span class="token operator">-&gt;</span>sem_cond<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>S<span class="token operator">-&gt;</span>sem_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="读写锁"><a href="#读写锁" class="header-anchor">#</a> 读写锁</h4> <ul><li><p>读读共享，读写互斥，写写互斥</p></li> <li><p>读写锁允许多个读者进入读临界区，但当一些读者已经在读临界区时，若一个读者和一个写者同时申请进入临界区，会有两种选择</p> <ul><li>偏向读者的读写锁：允许读者进入，直到没有读者时才允许写者进入，增加了读者并行性</li> <li>偏向写者的读写锁：等之前的读者离开临界区后，先允许写者进入，再允许读者进入，避免写者陷入无限等待</li></ul></li></ul> <h4 id="rcu"><a href="#rcu" class="header-anchor">#</a> RCU</h4> <ul><li><p>虽然读写锁允许多个读者同时进入读临界区，但写者会阻塞读者，且读者仍需要在关键路径上添加读者锁，会造成一定性能开销</p></li> <li><p>RCU：Read-Copy Update 是操作系统内核中广泛使用的同步原语，有效减少读者在关键路径上的性能开销</p> <ul><li>允许多个读者同时进入临界区</li> <li>写者不会阻塞读者</li> <li>读者不需要额外的同步原语保护读临界区</li></ul></li> <li><p>RCU引入了一种订阅发布机制，利用对64位指针的读写的原子性，让写者能原子地更新任意大小的数据，在写者更新指针前，读者读到旧数据；写者更新指针后，读者读到新数据，可以互不阻塞执行临界区内容</p></li> <li><p>更新完指针后，旧数据可能处于被读状态，所以不能马上回收旧数据的内存，引入了宽限期的概念，用于描述从写者更新指针到最后一个可能观察到旧数据的读者离开的这段时间，</p></li> <li><p>读者需要标明读临界区的开始与结束 ，以及使用订阅接口读取指针即可；但写者仍然需要使用互斥锁保证写者之间的互斥访问</p></li></ul> <h4 id="管程"><a href="#管程" class="header-anchor">#</a> 管程</h4> <ul><li>线程安全：某个函数在多线程环境下被调用时，能正确使用同步原语保护多个线程对共享变量的访问与修改</li> <li>管程（Monitor）：保证在同一时刻最多只有一个操作者能进入管程的保护区域访问共享数据，开发者只需调用管程提供的函数，无需使用额外的同步原语，从而减轻负担
<ul><li>Java程序中使用synchronized关键字及其对应管程来实现不同线程间的同步，Java的管程保证对于synchronized关键字保护的代码区域，最多只有一个Java线程能进入这些区域处理数据</li></ul></li></ul> <h4 id="同步带来的问题"><a href="#同步带来的问题" class="header-anchor">#</a> 同步带来的问题</h4> <h5 id="死锁"><a href="#死锁" class="header-anchor">#</a> 死锁</h5> <ul><li><p>定义：一组线程中的每一个都在等待组内其他线程释放资源从而造成的无限等待</p></li> <li><p>案例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">proc_A</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">lock</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// t0</span>
  <span class="token function">lock</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// critical area</span>
  <span class="token function">unlock</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">unlock</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">proc_B</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">lock</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// t0</span>
  <span class="token function">lock</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// critical area</span>
  <span class="token function">unlock</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">unlock</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>出现死锁的四个必要条件：互斥访问、持有并等待、资源非抢占、循环等待</p></li> <li><p>死锁检测与恢复：</p> <ul><li>死锁检测
<ul><li>循环等待是死锁检测的关键，将资源和线程视为节点，维护一个资源分配表，若资源被线程占有，则画一条从资源到线程的实箭头，维护一个线程等待表，若线程等待资源，则画一条从线程到资源的虚箭头；若图中出现环，则出现死锁</li> <li>一般采用定时监测，超时等待检测的方法避免频繁检测带来严重的性能开销</li></ul></li> <li>死锁预防
<ul><li>避免互斥访问：需要增加代理线程处理共享数据；此法系统负担过大</li> <li>不允许持有并等待：要求线程在开始操作前一次性申请所有资源，若任一资源不可用，则必须放弃已经成功申请的资源；当资源竞争度高时，此法会陷入申请-释放循环，导致资源利用率低甚至饥饿的情况</li> <li>允许资源被抢占：允许线程抢占其他线程已经拥有的资源；此法的回滚恢复操作十分困难，仅适用于易于保存和恢复的场景</li> <li>避免循环等待：对所有资源进行编号，线程申请资源时需要按照资源编号递增的顺序申请；在任意时刻，系统总会有一个得到资源编号最大的线程，其之后申请的资源都未被占有，故线程可以继续执行，不会陷入循环等待</li></ul></li> <li>死锁避免
<ul><li>银行家算法：通过模拟分配资源后的状态，判断分配某个资源后系统是否处于安全状态，从而决定是否分配该资源
<ul><li>初始化：设系统中存在M类资源，线程有N个，定义若干数据结构
<ul><li>全局可用资源：<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="12.977ex" height="2.262ex" viewBox="0 -750 5736 1000" style="vertical-align:-0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mi" transform="translate(750, 0)"><path data-c="76" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(1235, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1764, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2109, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(2407, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(2936, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3365, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(3663, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mo" transform="translate(4129, 0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mi" transform="translate(4407, 0)"><path data-c="4D" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mo" transform="translate(5458, 0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g></g></g></svg></mjx-container></li> <li>每个线程最大需求量：<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="11.771ex" height="2.262ex" viewBox="0 -750 5203 1000" style="vertical-align:-0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="4D" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(1051, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1580, 0)"><path data-c="78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(2152, 0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mi" transform="translate(2430, 0)"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(3318, 0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g><g data-mml-node="mo" transform="translate(3596, 0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mi" transform="translate(3874, 0)"><path data-c="4D" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mo" transform="translate(4925, 0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g></g></g></svg></mjx-container></li> <li>已分配资源数量：<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="17.274ex" height="2.262ex" viewBox="0 -750 7635 1000" style="vertical-align:-0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mi" transform="translate(750, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(1048, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(1346, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(1831, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(2264, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(2793, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(3154, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3499, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3984, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(4584, 0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mi" transform="translate(4862, 0)"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(5750, 0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g><g data-mml-node="mo" transform="translate(6028, 0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mi" transform="translate(6306, 0)"><path data-c="4D" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mo" transform="translate(7357, 0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g></g></g></svg></mjx-container></li> <li>还需要资源数量：<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="12.197ex" height="2.262ex" viewBox="0 -750 5391 1000" style="vertical-align:-0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mi" transform="translate(888, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1354, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1820, 0)"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(2340, 0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mi" transform="translate(2618, 0)"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(3506, 0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g><g data-mml-node="mo" transform="translate(3784, 0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mi" transform="translate(4062, 0)"><path data-c="4D" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mo" transform="translate(5113, 0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g></g></g></svg></mjx-container></li></ul></li></ul></li></ul></li></ul></li></ul> <h5 id="活锁"><a href="#活锁" class="header-anchor">#</a> 活锁</h5> <ul><li>活锁并未发生阻塞，而是线程不断重复尝试-失败-尝试的过程，有机会自行解开</li></ul> <h5 id="优先级反转"><a href="#优先级反转" class="header-anchor">#</a> 优先级反转</h5> <ul><li>由于同步导致线程执行顺序违反预设优先级的问题，如下图案例，线程优先级 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="11.223ex" height="1.791ex" viewBox="0 -626 4960.8 791.6" style="vertical-align:-0.375ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mn" transform="translate(361, -150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mo" transform="translate(1042.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="msub" transform="translate(2098.1, 0)"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mn" transform="translate(361, -150) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(3140.4, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="msub" transform="translate(4196.2, 0)"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mn" transform="translate(361, -150) scale(0.707)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g></g></g></g></svg></mjx-container>，但因为<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.73ex" height="1.756ex" viewBox="0 -626 764.6 776" style="vertical-align:-0.339ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mn" transform="translate(361, -150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></svg></mjx-container>需要的资源被<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.73ex" height="1.791ex" viewBox="0 -626 764.6 791.6" style="vertical-align:-0.375ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mn" transform="translate(361, -150) scale(0.707)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g></g></g></g></svg></mjx-container>先占了，导致<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.73ex" height="1.756ex" viewBox="0 -626 764.6 776" style="vertical-align:-0.339ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mn" transform="translate(361, -150) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container>被优先调度执行完毕后，到<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.73ex" height="1.791ex" viewBox="0 -626 764.6 791.6" style="vertical-align:-0.375ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mn" transform="translate(361, -150) scale(0.707)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g></g></g></g></svg></mjx-container>离开临界区，才是 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.73ex" height="1.756ex" viewBox="0 -626 764.6 776" style="vertical-align:-0.339ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mn" transform="translate(361, -150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></svg></mjx-container></li></ul> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtv66vf8sqj619g0n5n1v02.jpg" alt=""></p> <ul><li><p>不可抢占临界区协议（NCP）：一旦线程进入临界区，不允许其他线程抢占；此法能解决优先级反转问题，但会因为阻塞影响到没有竞争关系的高优先级线程，导致其错过截止时间</p></li> <li><p>优先级继承协议（PIP）：当高优先级线程等待锁时，会使锁的持有者继承其优先级，从而避免该锁的临界区被低优先级的任务打断，如下图所示（但有更高优先级线程到来时，会被打断）</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtv6b1c9mzj61bu0obagl02.jpg" alt=""></p></li> <li><p>优先级置顶协议（PCP）：获取锁的线程的优先级置为可能竞争该锁的线程中的最高优先级，让临界区内的线程尽快执行完成</p> <ul><li>即时优先级置顶协议（IPCP）：线程在获取锁时，就将自己的优先级提升</li> <li>原生优先级置顶协议（OPCP）：出现其他线程竞争资源时，才将自己的优先级提升</li></ul></li> <li><p>NCP和IPCP实现难度较小，仅需禁止抢占和在获取锁时提升优先级；PIP和OPCP实现难度较大，需要监视已经被获取的锁，在其他线程尝试获取该锁时提升拥有者的优先级</p></li></ul> <h4 id="案例分析-linux中的futex"><a href="#案例分析-linux中的futex" class="header-anchor">#</a> 案例分析：Linux中的futex</h4> <ul><li>futex：fast user-space mutex 机制，使用futex机制实现的互斥锁在竞争程度低时，直接使用原子操作完成加锁，在竞争程度高时，通过系统调用挂起并等待被后续锁持有者唤醒。futex机制不仅用于避免互斥锁中的循环等待，还能用于实现条件变量等各类同步原语</li></ul> <h2 id="chap9-文件系统"><a href="#chap9-文件系统" class="header-anchor">#</a> Chap9 文件系统</h2> <p>Linux内核的存储软件栈</p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gu19a7pezoj60sn0sm7bc02.jpg" style="zoom:33%;"> <ul><li>网络文件下载流程：
<ul><li>1、文件内容暂存在下载工具的内存中</li> <li>2、下载工具向操作系统发生一系列系统调用（open、write），以持久保存下来</li> <li>3、Linux内核调用虚拟文件系统（VFS）处理文件请求，VFS是大管家，负责管理具体文件系统以及提供一系列缓存服务（页缓存、inode缓存、目录项缓存），VFS会调用具体文件系统处理请求（如EXT4）</li> <li>4、需要访问存储设备上的数据时，文件系统会创建对存储块的访问请求，并发送给IO调度器</li> <li>5、IO调度器根据预定策略调度请求，发送给设备驱动</li> <li>6、设备驱动与存储设备交互完成请求</li></ul></li></ul> <h4 id="基于inode的文件系统"><a href="#基于inode的文件系统" class="header-anchor">#</a> 基于inode的文件系统</h4> <h5 id="inode与文件"><a href="#inode与文件" class="header-anchor">#</a> inode与文件</h5> <ul><li><p>定义：index node，索引节点，记录了一个文件对应的所有存储块号</p></li> <li><p>每个inode对应一个文件，采用分级的方式来组织存储块号（参考页表的方式），除此之外，inode还记录了文件元数据：文件模式、文件链接数、文件拥有者和用户组、文件大小、文件访问时间（注意：文件名不是文件的元数据！！！）</p></li> <li><p>Linux中支持的文件类型</p> <ul><li><table><thead><tr><th>文件类型</th> <th>文件用途</th></tr></thead> <tbody><tr><td>常规文件</td> <td>保存数据</td></tr> <tr><td>目录文件</td> <td>表示和组织一组文件</td></tr> <tr><td>符号链接文件</td> <td>保存符号链接（指向目标文件的路径）</td></tr> <tr><td>FIFO文件</td> <td>以队列形式传递数据，又称命名管道</td></tr> <tr><td>套接字文件</td> <td>用于传递数据，比FIFO文件更灵活</td></tr> <tr><td>字符设备文件</td> <td>表示和访问字符设备</td></tr> <tr><td>块设备文件</td> <td>表示和访问块设备</td></tr></tbody></table></li></ul></li></ul> <h5 id="文件名与目录"><a href="#文件名与目录" class="header-anchor">#</a> 文件名与目录</h5> <ul><li>文件系统增加了字符串形式的文件名，并增加一层从文件名字符串到inode号之间的映射，便于记忆，且解耦合</li> <li>目录是一种特殊类型的文件，保存的是目录项，每个目录项代表一条文件信息，包括（inode、目录项长度、文件名长度、文件名）</li> <li>Linux中使用tree命令可以查看目录结构，每个目录中有两个特殊的目录项，<code>.</code>和<code>..</code>，对应当前目录和上级目录</li> <li>对目录的操作包括
<ul><li>查找：依次比较目录项中的文件名，在对应的inode上进行若干操作</li> <li>遍历：依次检查，并通过回调函数返回有效的目录项</li> <li>增加：重用无效的目录项或追加新的目录项在文件结尾</li> <li>删除：通过将inode号变为0来标记此目录项无效，高效利用空间；同时，文件删除时，可以将相邻的无效目录项进行合并，以允许更长的新目录项重新利用这些空间</li></ul></li></ul> <h5 id="硬链接与符号链接"><a href="#硬链接与符号链接" class="header-anchor">#</a> 硬链接与符号链接</h5> <ul><li>由于文件名不是文件的元数据，故一个文件可以对应多个文件名，即多个目录项指向同一个inode，Linux中使用<code>ln [file] [link]</code>命令创建出一个硬链接，硬链接与原文件具有同等地位</li> <li>当一个目录项被删除时，其对应的inode的链接数-1，当链接数为0时，inode及其索引的结构和数据可以被销毁，空间得以释放</li> <li>文件系统层面的操作只允许删除空的目录文件，所以<code>rm -r [dir]</code>命令，是自底向上依次删除遇到的文件，最后才将已经删空的dir目录删除</li> <li>符号链接（软链接）是一种特殊的文件类型，保存的不是目录项，而是一个表示文件路径的字符串，Linux中使用<code>ln -s [file] [link]</code>创建，符号链接文件除了创建删除外，只支持读取操作</li> <li>硬链接和符号链接的差别
<ul><li>符号链接中，用户可以随便存放路径，仅当真正解析时才会报路径不存在的错</li> <li>硬链接要求目标文件不能为目录，而软链接可以</li> <li>软链接不受文件系统边界的限制，但硬链接的目标文件只能在同一个文件系统内</li></ul></li></ul> <h5 id="存储布局"><a href="#存储布局" class="header-anchor">#</a> 存储布局</h5> <ul><li>文件系统通常将存储空间划分成不同区域，用于不同功能，如下图所示</li></ul> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gu1eq8fv6nj618z0nzn2r02.jpg" style="zoom:50%;"> <ul><li>超级块：记录整个文件系统的全局元数据，如代表不同文件系统的魔法数字，文件系统的版本，文件系统管理的空间的大小，最后一次挂载时间和一些统计信息（支持的最大inode数量、当前可用inode数量，支持的最大块数量，当前可用块数量）</li> <li>块分配信息：使用位图格式标记文件数据块区域中各个块的使用情况，1代表已分配使用，0代表空闲</li> <li>inode分配信息：与块分配信息类似，对应的是inode表中每个inode的使用情况</li> <li>inode表：以数组形式保存整个文件系统中所有的inode结构</li> <li>文件数据块：保存数据的区域，故一个存储设备上创建一个新的文件系统后，系统显示可用大小往往比实际存储设备总容量小</li></ul> <h4 id="虚拟文件系统"><a href="#虚拟文件系统" class="header-anchor">#</a> 虚拟文件系统</h4> <ul><li>计算机系统中可能存在多个文件系统，如用户分别使用NTFS和Ext4两个文件系统管理一块机械硬盘上的不同区域，如用户将FAT32文件系统格式的USB盘接入计算机系统中</li> <li>虚拟文件系统管理和协调多种文件系统，使其在同一操作系统上共同工作，VFS定义了一系列内存数据结构，并要求底层不同文件系统提供指定方法，然后利用这些方法，将不同文件系统的元数据统一转换为VFS的内存数据结构，VFS通过这些数据结构，向上为应用程序提供统一的文件系统服务</li></ul> <h5 id="面向文件系统的接口"><a href="#面向文件系统的接口" class="header-anchor">#</a> 面向文件系统的接口</h5> <ul><li>Linux的VFS基于inode制定了一系列的内存数据结构，包括超级块，inode，目录项等
<ul><li>超级块：保存文件系统通用元数据信息，如文件系统类型、版本、挂载点信息等，每个挂载的文件系统实例均在内存中维护一个VFS超级块结构，VFS超级块还包括一个指针，指向特有的超级块信息</li> <li>inode：VFS维护了inode缓存icache，用哈希表保存操作系统中所有的inode结构</li> <li>文件数据管理：VFS的inode会使用基数树表示一个文件的数据，基数树中每个叶子节点为一个内存页</li> <li>目录项：VFS维护了目录项缓存dcache</li></ul></li> <li>Linux的VFS以函数指针的方式定义了文件系统应提供的方法，Linux的VFS为其内存数据结构分别定义了不同的文件系统方法，下面是文件结构的例子，主要包括open、read、read_iter、write、write_iter、llseek（定位）、mmap（内存映射）、fsync（同步写回）等操作</li></ul> <h5 id="面向应用程序的接口"><a href="#面向应用程序的接口" class="header-anchor">#</a> 面向应用程序的接口</h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DATA_SIZE</span> <span class="token expression"><span class="token number">20</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">int</span> fd<span class="token punctuation">;</span>
  <span class="token keyword">char</span> data<span class="token punctuation">[</span>DATA_SIZE<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;/home/chcore/filesystem.tex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> O_RDWR<span class="token operator">|</span>O_CREAT<span class="token punctuation">,</span> S_IRUSR<span class="token operator">|</span>S_IWUSR<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> data<span class="token punctuation">,</span> DATA_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
  data<span class="token punctuation">[</span>DATA_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;file data: %s\n&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token string">&quot;hello\n&quot;</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>路径解析：程序调用open接口时，libc会将其转换为SYS_OPEN系统调用，由内核中的VFS进行处理，它需要先解析路径，解析时，会先从根目录开始查找home文件，缓存找不到则从具体文件系统接口找，若无法找到，则报错，若找到，会检查当前应用程序是否有访问该文件的权限，该文件是否为目录文件，是否为符号链接等等；若找到最后，没有filesystem.tex，则因为有 O_CREAT标记，故VFS会创建一个空文件并继续路径查找操作，路径解析完毕后，VFS获取了文件对应的inode，并返回文件描述符</li> <li>文件描述符：实际上是一个由VFS维护的整数，VFS为每个进程维护一个文件描述符表，该表以文件描述符为索引，保存了一组文件描述结构，记录了一个被打开文件的各种信息，如目标inode、文件当前读写位置、文件打开的模式等等；后续的read、write操作都通过文件描述符进行（POSIX中，有3个文件描述符在进程创建时被默认打开，分别是标准输入流0，标准输出流1，标准错误流2）</li> <li>文件的统计：无须打开文件，直接使用lstat和stat函数，通过路径读取文件的元数据信息，在目标文件为符号链接时，lstat返回符号链接的信息，而stat继续跟随符号链接，走到最后</li> <li>文件读写：常规文件读写接口（read、write、pread、pwrite）需要提供文件描述符、用于读写的缓冲区、需要读写的字节数，且以p开头的接口需要额外提供一个读写偏移量表示开始读取或写入的位置；对于频繁地随机访问文件，使用p开头的接口比使用lseek再进行读写操作更省时</li> <li>目录操作：mkdir、rmdir接口用于创建删除目录，应用程序可以通过文件描述符或路径打开一个目录流，随后调用readdir或readdir_r接口从目录流中读取目录项的信息，closedir用于关闭目录流</li> <li>链接相关：symlink和symlinkat函数用于创建符号链接；link和linkat函数用于创建硬链接，unlink和unlinkat函数用于删除链接或符号链接；readlink和readlinkat函数用于读取符号链接中的目标路径</li></ul> <h5 id="页缓存、直接i-o与内存映射"><a href="#页缓存、直接i-o与内存映射" class="header-anchor">#</a> 页缓存、直接I/O与内存映射</h5> <h2 id="chap10-设备管理"><a href="#chap10-设备管理" class="header-anchor">#</a> Chap10 设备管理</h2> <h2 id="chap11-系统虚拟化"><a href="#chap11-系统虚拟化" class="header-anchor">#</a> Chap11 系统虚拟化</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2/9/2022, 11:08:47 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/vuepressBlog/assets/js/app.6b528729.js" defer></script><script src="/vuepressBlog/assets/js/2.ab72813d.js" defer></script><script src="/vuepressBlog/assets/js/49.0df47a3b.js" defer></script>
  </body>
</html>
