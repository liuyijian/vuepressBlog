<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>STL | lyj Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.0/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css">
    <meta name="description" content="我来到，我看见，我记录">
    
    <link rel="preload" href="/vuepressBlog/assets/css/0.styles.bc106160.css" as="style"><link rel="preload" href="/vuepressBlog/assets/js/app.6b528729.js" as="script"><link rel="preload" href="/vuepressBlog/assets/js/2.ab72813d.js" as="script"><link rel="preload" href="/vuepressBlog/assets/js/112.0979c7a8.js" as="script"><link rel="prefetch" href="/vuepressBlog/assets/js/10.8dbed780.js"><link rel="prefetch" href="/vuepressBlog/assets/js/100.265d117f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/101.8f8a8877.js"><link rel="prefetch" href="/vuepressBlog/assets/js/102.23d7fb47.js"><link rel="prefetch" href="/vuepressBlog/assets/js/103.1d17fb3c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/104.264b70e0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/105.03575d7f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/106.9c1f2507.js"><link rel="prefetch" href="/vuepressBlog/assets/js/107.7bb9227b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/108.4ea416bb.js"><link rel="prefetch" href="/vuepressBlog/assets/js/109.cf8ae3d3.js"><link rel="prefetch" href="/vuepressBlog/assets/js/11.8c13b148.js"><link rel="prefetch" href="/vuepressBlog/assets/js/110.1236666f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/111.3c6af209.js"><link rel="prefetch" href="/vuepressBlog/assets/js/113.028ac5b9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/114.707489a5.js"><link rel="prefetch" href="/vuepressBlog/assets/js/115.927139bd.js"><link rel="prefetch" href="/vuepressBlog/assets/js/116.e244de92.js"><link rel="prefetch" href="/vuepressBlog/assets/js/117.c65e62a1.js"><link rel="prefetch" href="/vuepressBlog/assets/js/118.c3b34688.js"><link rel="prefetch" href="/vuepressBlog/assets/js/12.59432e93.js"><link rel="prefetch" href="/vuepressBlog/assets/js/13.31bd9a84.js"><link rel="prefetch" href="/vuepressBlog/assets/js/14.0b06810f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/15.e0a7d109.js"><link rel="prefetch" href="/vuepressBlog/assets/js/16.d8d547ec.js"><link rel="prefetch" href="/vuepressBlog/assets/js/17.f801f702.js"><link rel="prefetch" href="/vuepressBlog/assets/js/18.ced7fc49.js"><link rel="prefetch" href="/vuepressBlog/assets/js/19.6d9a078f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/20.d6705a8a.js"><link rel="prefetch" href="/vuepressBlog/assets/js/21.6c7be3a0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/22.2f97e4c4.js"><link rel="prefetch" href="/vuepressBlog/assets/js/23.dc5ad835.js"><link rel="prefetch" href="/vuepressBlog/assets/js/24.b5ad9a7c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/25.2346045f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/26.169166b1.js"><link rel="prefetch" href="/vuepressBlog/assets/js/27.a1f119d7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/28.aba4012d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/29.57cce391.js"><link rel="prefetch" href="/vuepressBlog/assets/js/3.23012698.js"><link rel="prefetch" href="/vuepressBlog/assets/js/30.94a6a846.js"><link rel="prefetch" href="/vuepressBlog/assets/js/31.e44548f9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/32.5d9dbd37.js"><link rel="prefetch" href="/vuepressBlog/assets/js/33.cf0304c0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/34.b35a928e.js"><link rel="prefetch" href="/vuepressBlog/assets/js/35.0aa23f25.js"><link rel="prefetch" href="/vuepressBlog/assets/js/36.7c5cbd35.js"><link rel="prefetch" href="/vuepressBlog/assets/js/37.9b6de082.js"><link rel="prefetch" href="/vuepressBlog/assets/js/38.0d6e1bc8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/39.be59fb9d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/4.6fcabf8c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/40.8b80be1d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/41.23df62c1.js"><link rel="prefetch" href="/vuepressBlog/assets/js/42.35a8f997.js"><link rel="prefetch" href="/vuepressBlog/assets/js/43.9ce1d5e9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/44.bae8e83b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/45.35ce70d4.js"><link rel="prefetch" href="/vuepressBlog/assets/js/46.e06716a9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/47.b7e42841.js"><link rel="prefetch" href="/vuepressBlog/assets/js/48.22a60f9c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/49.0df47a3b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/5.1d5afe99.js"><link rel="prefetch" href="/vuepressBlog/assets/js/50.5f971bb0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/51.5337bbe5.js"><link rel="prefetch" href="/vuepressBlog/assets/js/52.4aad9c1e.js"><link rel="prefetch" href="/vuepressBlog/assets/js/53.65883b8c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/54.b19ee5b4.js"><link rel="prefetch" href="/vuepressBlog/assets/js/55.6d78921b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/56.26edb079.js"><link rel="prefetch" href="/vuepressBlog/assets/js/57.16de1284.js"><link rel="prefetch" href="/vuepressBlog/assets/js/58.57c9ad4f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/59.d7a83af1.js"><link rel="prefetch" href="/vuepressBlog/assets/js/6.b0f500a7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/60.ef641f0b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/61.06ada8a9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/62.c201181c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/63.5e0956b9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/64.1333c3ce.js"><link rel="prefetch" href="/vuepressBlog/assets/js/65.85bd3acc.js"><link rel="prefetch" href="/vuepressBlog/assets/js/66.91aa8c33.js"><link rel="prefetch" href="/vuepressBlog/assets/js/67.43f04cc7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/68.8c167799.js"><link rel="prefetch" href="/vuepressBlog/assets/js/69.799a9ad6.js"><link rel="prefetch" href="/vuepressBlog/assets/js/7.0ebb7ad8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/70.ed6ad575.js"><link rel="prefetch" href="/vuepressBlog/assets/js/71.8aa5c2a3.js"><link rel="prefetch" href="/vuepressBlog/assets/js/72.8959f876.js"><link rel="prefetch" href="/vuepressBlog/assets/js/73.2591c30a.js"><link rel="prefetch" href="/vuepressBlog/assets/js/74.9a3e7ac8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/75.e902c941.js"><link rel="prefetch" href="/vuepressBlog/assets/js/76.097b0b26.js"><link rel="prefetch" href="/vuepressBlog/assets/js/77.30a31958.js"><link rel="prefetch" href="/vuepressBlog/assets/js/78.ce43dac1.js"><link rel="prefetch" href="/vuepressBlog/assets/js/79.9f0ed644.js"><link rel="prefetch" href="/vuepressBlog/assets/js/8.f2c8fce2.js"><link rel="prefetch" href="/vuepressBlog/assets/js/80.da97703b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/81.10ce4d4f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/82.2d30f3d7.js"><link rel="prefetch" href="/vuepressBlog/assets/js/83.5b635648.js"><link rel="prefetch" href="/vuepressBlog/assets/js/84.eef88086.js"><link rel="prefetch" href="/vuepressBlog/assets/js/85.9340d932.js"><link rel="prefetch" href="/vuepressBlog/assets/js/86.067a1e76.js"><link rel="prefetch" href="/vuepressBlog/assets/js/87.ff6fc498.js"><link rel="prefetch" href="/vuepressBlog/assets/js/88.448d4393.js"><link rel="prefetch" href="/vuepressBlog/assets/js/89.2dcf3001.js"><link rel="prefetch" href="/vuepressBlog/assets/js/9.1aea8c91.js"><link rel="prefetch" href="/vuepressBlog/assets/js/90.8d5c1be2.js"><link rel="prefetch" href="/vuepressBlog/assets/js/91.84fca09d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/92.0c6e9ee5.js"><link rel="prefetch" href="/vuepressBlog/assets/js/93.94030fdd.js"><link rel="prefetch" href="/vuepressBlog/assets/js/94.632a92a4.js"><link rel="prefetch" href="/vuepressBlog/assets/js/95.0327fc6f.js"><link rel="prefetch" href="/vuepressBlog/assets/js/96.6cbe2c2b.js"><link rel="prefetch" href="/vuepressBlog/assets/js/97.bab10e51.js"><link rel="prefetch" href="/vuepressBlog/assets/js/98.1f3d3a36.js"><link rel="prefetch" href="/vuepressBlog/assets/js/99.f3b11738.js">
    <link rel="stylesheet" href="/vuepressBlog/assets/css/0.styles.bc106160.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepressBlog/" class="home-link router-link-active"><!----> <span class="site-name">lyj Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepressBlog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TechNote" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="TechNote" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础知识
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/algorithms/" class="nav-link">
  基础算法
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/network/" class="nav-link">
  网络原理
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/os/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          算法研究
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/recommendation_system/" class="nav-link">
  推荐系统
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/knowledge_graph/" class="nav-link">
  知识图谱
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/nlp/" class="nav-link">
  自然语言处理
</a></li></ul></li><li class="dropdown-item"><h4>
          工程实践
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/FFmpeg/" class="nav-link">
  FFmpeg
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Python/" class="nav-link router-link-active">
  Python
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="InvestNote" class="dropdown-title"><span class="title">投资心得</span> <span class="arrow down"></span></button> <button type="button" aria-label="InvestNote" class="mobile-dropdown-title"><span class="title">投资心得</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/economic/" class="nav-link">
  经济
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/chan/" class="nav-link">
  缠论
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/options/" class="nav-link">
  期权
</a></li></ul></div></div><div class="nav-item"><a href="/vuepressBlog/resource/" class="nav-link">
  资源聚合
</a></div> <a href="https://github.com/liuyijian/vuepressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepressBlog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TechNote" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="TechNote" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础知识
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/algorithms/" class="nav-link">
  基础算法
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/network/" class="nav-link">
  网络原理
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/basic/os/" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          算法研究
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/recommendation_system/" class="nav-link">
  推荐系统
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/knowledge_graph/" class="nav-link">
  知识图谱
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/algorithms/nlp/" class="nav-link">
  自然语言处理
</a></li></ul></li><li class="dropdown-item"><h4>
          工程实践
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/FFmpeg/" class="nav-link">
  FFmpeg
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/Python/" class="nav-link router-link-active">
  Python
</a></li><li class="dropdown-subitem"><a href="/vuepressBlog/techNote/engineering/JavaScript/" class="nav-link">
  JavaScript
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="InvestNote" class="dropdown-title"><span class="title">投资心得</span> <span class="arrow down"></span></button> <button type="button" aria-label="InvestNote" class="mobile-dropdown-title"><span class="title">投资心得</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/economic/" class="nav-link">
  经济
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/chan/" class="nav-link">
  缠论
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/investNote/options/" class="nav-link">
  期权
</a></li></ul></div></div><div class="nav-item"><a href="/vuepressBlog/resource/" class="nav-link">
  资源聚合
</a></div> <a href="https://github.com/liuyijian/vuepressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Python 学习笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepressBlog/techNote/engineering/Python/environment.html" class="sidebar-link">Python环境配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepressBlog/techNote/engineering/Python/stl.html" aria-current="page" class="active sidebar-link">Python标准库 </a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/engineering/Python/stl.html#multiprocessing" class="sidebar-link">multiprocessing</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/techNote/engineering/Python/stl.html#re" class="sidebar-link">re</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="stl"><a href="#stl" class="header-anchor">#</a> STL</h1> <ul><li>本文挑选了一些实用但难以上手的标准库进行系统性学习，其中，标准库是基于Python3.7的。</li> <li>时至今日，python3.9的出现，引入了很多新特性，所以，keep learning吧少年！</li></ul> <h2 id="multiprocessing"><a href="#multiprocessing" class="header-anchor">#</a> multiprocessing</h2> <h3 id="进程"><a href="#进程" class="header-anchor">#</a> 进程</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> multiprocessing <span class="token keyword">as</span> ml
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> time

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
		time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span>

<span class="token comment">#新建一个进程，target为可调用对象，name为进程名字，args为位置参数元组</span>
p <span class="token operator">=</span> ml<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target <span class="token operator">=</span> foo<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'lyj'</span><span class="token punctuation">,</span>args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#检查进程是否在运行</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token boolean">False</span>
<span class="token comment">#进程的身份验证键，除非显式设定，否则由os.urandom()函数生成的32字符的字符串，为网络底层通讯安全提供保障</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>authkey
	<span class="token string">b'\x16\xe9\x19\xe0\xe3\xa3\\\xa9W\x9d\xa5\xf6\xd3\xb7\xf1?\xfd4\xe0\x85M|\t\xd3v\xc7\xf8J\xd3e\xed\xa4'</span>
<span class="token comment">#指示进程是否为后台进程，当父进程终止时，后台进程自动终止，且后台进程不能创建自己的新进程，此值需在start()函数启动前设置</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>daemon
	<span class="token boolean">False</span>
<span class="token comment">#进程名</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>name
	<span class="token string">'lyj'</span>
<span class="token comment">#进程运行时的整数进程ID,不运行时没有</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>pid
	<span class="token number">22286</span>
<span class="token comment">#启动子进程，进程名就是我们定义的name</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#进程启动时运行的方法，并不启动一个新进程，就是在主线程中调用了一个普通函数而已。</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="工具函数"><a href="#工具函数" class="header-anchor">#</a> 工具函数</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> multiprocessing <span class="token keyword">as</span> ml
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ml<span class="token punctuation">.</span>active_children<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ml<span class="token punctuation">.</span>cpu_count<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token number">12</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ml<span class="token punctuation">.</span>current_process<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token operator">&lt;</span>_MainProcess<span class="token punctuation">(</span>MainProcess<span class="token punctuation">,</span> started<span class="token punctuation">)</span><span class="token operator">&gt;</span>
</code></pre></div><h3 id="进程间通信-队列方式"><a href="#进程间通信-队列方式" class="header-anchor">#</a> 进程间通信-队列方式</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> multiprocessing <span class="token keyword">as</span> ml

<span class="token comment">#创建共享的进程队列，参数为队列允许最大项数，若省略，则无大小限制。底层队列使用管道和锁实现</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q <span class="token operator">=</span> ml<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token comment">#连接队列的后台进程，在q.close()后，等待所有队列项被消耗；默认情况下，此方法由不是q的原始创建者的所有进程调用</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>join_thread<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#不会在进程退出时自动连接后台线程</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>cancel_join_thread<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#关闭队列，防止队列加入更多数据，若q被垃圾回收，自动调用该方法</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#检查队列满或空，及当前数量，但时间差导致结果不一定可靠</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token boolean">False</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token boolean">True</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token number">0</span>
<span class="token comment">#返回q中的一个项，默认参数block = True，即若q为空，将阻塞至有项为止，若block = False， 将引发Queue.empty()异常；可选参数timeout为超时时间，用于阻塞模式，若一定时间内无项可用，则引发Queue.empty()异常</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span>block <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> timeout <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>get_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#将item放入队列，若队列已满，则阻塞至有空间可用为止，block控制阻塞行为，timeout指定阻塞模式下可用空间的时间长短，超时后引发Queue.full()异常</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>item <span class="token operator">=</span> <span class="token string">'A'</span><span class="token punctuation">,</span>block <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> timeout <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>put_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#可连接的共享进程队列，允许项的消费者通知生产者，项已经被成功处理，除了普通Queue对象的方法外，还有以下方法</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q <span class="token operator">=</span> ml<span class="token punctuation">.</span>JoinableQueue<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token comment">#消费者使用此方法发出信号，表示q.get()返回的项已被处理</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#生产者使用此方法进行阻塞，直到队列所有项已经被处理，阻塞将持续到每个项均调用task_done()方法为止</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="案例-队列方式"><a href="#案例-队列方式" class="header-anchor">#</a> 案例——队列方式</h4> <ul><li>放入队列的每个项会被序列化，通过管道或套接字连接发送给进程</li> <li>一般来说，发送数量较少的大对象比发送大量小对象更好</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> multiprocessing <span class="token keyword">as</span> ml

<span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span>input_q<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
		item <span class="token operator">=</span> input_q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> item <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
			input_q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">break</span>
		<span class="token comment">#处理工作</span>
		input_q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">producer</span><span class="token punctuation">(</span>sequence<span class="token punctuation">,</span> output_q<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> item <span class="token keyword">in</span> sequence<span class="token punctuation">:</span>
		output_q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

<span class="token comment">#创建共享进程队列</span>
q <span class="token operator">=</span> ml<span class="token punctuation">.</span>JoinableQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#运行消费者进程</span>
con_p <span class="token operator">=</span> ml<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target <span class="token operator">=</span> consumer<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">(</span>q<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
con_p<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
con_p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#生产多个项</span>
sequence <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>
producer<span class="token punctuation">(</span>sequence<span class="token punctuation">,</span> q<span class="token punctuation">)</span>
<span class="token comment">#在队列上安置哨兵，发出完成信号,若存在n个消费者进程，则要放n个哨兵</span>
q<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token comment">#等待项被处理,防止主程序被关闭后，消费被提前终止</span>
q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="进程间通信-管道方式"><a href="#进程间通信-管道方式" class="header-anchor">#</a> 进程间通信-管道方式</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#创建一条管道，返回元组（conn1,conn2），表示管道两端的connection对象，默认情况下，管道为双向，若将默认参数duplex改为False，则conn1只能接收，conn2只能发送，必须在创建和启用使用管道的Process对象前调用pipe()方法</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>server_p<span class="token punctuation">,</span>client_p<span class="token punctuation">)</span> <span class="token operator">=</span> ml<span class="token punctuation">.</span>Pipe<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#Pipe()方法返回的两个connection对象，有以下方法属性</span>

<span class="token comment">#关闭管道，可选任意一边关闭，若connection对象被垃圾回收，则会自动调用该方法</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#返回连接使用的整数文件描述符</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#若连接上的数据可用，返回True，timeout是指定等待最长时限，默认为0，马上返回结果，若将其置为None，则无限期等待数据到达</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span>poll<span class="token punctuation">(</span><span class="token punctuation">[</span>timeout<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#接收c.send()返回的对象，若连接的另一端已经关闭，不存在任何数据，则引发EOFError</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#接收c.send_bytes()方法发送的一条完整的字节信息，maxlength指定要接受的最大字节数，若进入的消息超过这个值，则引发IOError，若另一侧已关闭，则引发EOFError</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span>recv_bytes<span class="token punctuation">(</span><span class="token punctuation">[</span>maxlength<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#接收一条完整的字节信息，并把它保存在buffer对象中,offset指定缓冲区中放置消息处的字节位移，返回值是收到的字节数，若消息长于可用缓冲区空间，则引发BufferTooShort异常</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span>recv_bytes_into<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token punctuation">,</span>offset<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#通过连接发送对象，obj是与序列化兼容的任意对象</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span>send<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token comment">#通过连接发送字节数据缓冲区，buffer是支持缓冲区接口的任意对象，offset是缓冲区中的字节偏移量，size是发送字节数，结果数据以单条消息的形式发出</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span>send_bytes<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token punctuation">,</span>offset<span class="token punctuation">[</span><span class="token punctuation">,</span>size<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="案例-管道方式"><a href="#案例-管道方式" class="header-anchor">#</a> 案例——管道方式</h4> <ul><li>若生产者或消费者没有使用管道的某个端点，就应该关闭它，管道是由操作系统进行引用计数的，必须在所有进程中关闭管道后才能生成EOFError异常</li> <li>不同进程的管道状态是独立的</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> multiprocessing <span class="token keyword">as</span> ml

<span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span>pipe<span class="token punctuation">)</span><span class="token punctuation">:</span>
	output_p<span class="token punctuation">,</span>input_p <span class="token operator">=</span> pipe
	input_p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
		<span class="token keyword">try</span><span class="token punctuation">:</span>
			item <span class="token operator">=</span> output_p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">except</span> EOFError<span class="token punctuation">:</span>
			<span class="token keyword">break</span>
		<span class="token comment">#处理项目</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'consumer done'</span><span class="token punctuation">)</span>
	
<span class="token keyword">def</span> <span class="token function">producer</span><span class="token punctuation">(</span>sequence<span class="token punctuation">,</span>input_p<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> item <span class="token keyword">in</span> sequence<span class="token punctuation">:</span>
		input_p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

output_p<span class="token punctuation">,</span> input_p <span class="token operator">=</span> ml<span class="token punctuation">.</span>Pipe<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#启动消费者进程</span>
cons_p <span class="token operator">=</span> ml<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target <span class="token operator">=</span> consumer<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>output_p<span class="token punctuation">,</span>input_p<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cons_p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#关闭生产者中的输出管道</span>
output_p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#生产项目</span>
sequence <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>
producer<span class="token punctuation">(</span>sequence<span class="token punctuation">,</span> input_p<span class="token punctuation">)</span>
<span class="token comment">#关闭输入管道，表示完成,不关则消费者一直循环</span>
input_p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#等待使用者进程关闭</span>
cons_p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="进程池"><a href="#进程池" class="header-anchor">#</a> 进程池</h3> <ul><li>可以把各种数据处理任务提交给进程池</li> <li>只有池工作进程执行足够弥补额外通信开销的工作，使用进程池才有意义</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> multiprocessing <span class="token keyword">as</span> ml
<span class="token comment">#创建工作进程池，processes是要创建的进程数，省略则使用cpu_count()的值，initializer是每个工作进程启动时要执行的可调用对象，默认为None。initargs是要传递给initializer的参数元组</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p <span class="token operator">=</span> ml<span class="token punctuation">.</span>Pool<span class="token punctuation">(</span><span class="token punctuation">[</span>processes<span class="token punctuation">[</span><span class="token punctuation">,</span>initializer<span class="token punctuation">[</span><span class="token punctuation">,</span>initargs<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#在一个池的工作进程中（非并行）执行函数func(*args,**kwargs),然后返回结果；主进程会被阻塞</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>func<span class="token punctuation">[</span><span class="token punctuation">,</span>args<span class="token punctuation">[</span><span class="token punctuation">,</span>kwargs<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 在一个池的工作进程中并行执行函数，返回结果是AsyncResult类的实例，callback是可调用对象，接收输入参数，当func的结果变为可用时，立刻传递给callback，callback禁止执行任何阻塞操作，否则将阻塞接收其他异步操作中的结果，</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>func<span class="token punctuation">[</span><span class="token punctuation">,</span>args<span class="token punctuation">[</span><span class="token punctuation">,</span>kwargs<span class="token punctuation">[</span><span class="token punctuation">,</span>callback<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
<span class="token comment">#关闭进程池，防止进一步操作，若有挂起的操作，他们将在工作进程终止之前完成</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#等待所有工作进程退出，只能在close()方法或terminate()方法之后调用</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#立即终止所有工作进程，同时不执行任何清理或结束任何挂起工作，若p被垃圾回收，自动调用此函数</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#将可调用对象func应用给iterable中的所有项，然后以课表形式返回结果，通过将iterable划分为多块并将工作分派给工作进程，可以并行执行，chunksize指定每块中的项数，若数据量较大，可提高chunksize来提升性能</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span>iterable<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">,</span>chunksize<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#同map()，返回AsyncResult类的实例，callback是可调用对象 </span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>map_async<span class="token punctuation">(</span>func<span class="token punctuation">,</span>iterable<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">,</span>chunksize<span class="token punctuation">[</span><span class="token punctuation">,</span>callback<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 同map()，但返回迭代器而非列表</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>imap<span class="token punctuation">(</span>func<span class="token punctuation">,</span>iterable<span class="token punctuation">[</span><span class="token punctuation">,</span>chunksize<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 同map(),但结果顺序根据完成时间任意确定</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>imap_unordered<span class="token punctuation">(</span>func<span class="token punctuation">,</span>iterable<span class="token punctuation">[</span><span class="token punctuation">,</span>chunksize<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
apply_async()和map_async()返回的值都是AsyncResult类的实例，拥有以下方法:
'''</span>
<span class="token comment">#返回结果</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">[</span>timeout<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#若调用完成，返回True </span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a<span class="token punctuation">.</span>ready<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#若调用完成且没有引发任何异常，返回True，若在结果就绪前调用此方法，引发AssertionError异常</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a<span class="token punctuation">.</span>successful<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#等待结果变为可用 </span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">[</span>timeout<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
</code></pre></div><h4 id="案例-apply-apply-async-map-map-async-方法效率对比"><a href="#案例-apply-apply-async-map-map-async-方法效率对比" class="header-anchor">#</a> 案例—— apply(), apply_async(), map(), map_async()方法效率对比</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> multiprocessing
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> multiprocessing<span class="token punctuation">.</span>current_process<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>sign<span class="token punctuation">)</span><span class="token punctuation">:</span>

    pool <span class="token operator">=</span> multiprocessing<span class="token punctuation">.</span>Pool<span class="token punctuation">(</span><span class="token punctuation">)</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> sign <span class="token operator">==</span> <span class="token string">'normal'</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;hello %d&quot;</span> <span class="token operator">%</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            pool<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> sign <span class="token operator">==</span> <span class="token string">'async'</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;hello %d&quot;</span> <span class="token operator">%</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            pool<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> sign <span class="token operator">==</span> <span class="token string">'map'</span><span class="token punctuation">:</span>
        results <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span><span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> sign <span class="token operator">==</span> <span class="token string">'map-async'</span><span class="token punctuation">:</span>
        results <span class="token operator">=</span> pool<span class="token punctuation">.</span>map_async<span class="token punctuation">(</span>func<span class="token punctuation">,</span><span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    pool<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> 
    pool<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>     
    end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span><span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'s'</span><span class="token punctuation">)</span>

sample <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">1000000</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> sample<span class="token punctuation">:</span>

    test<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">'normal'</span><span class="token punctuation">)</span>
    test<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">'async'</span><span class="token punctuation">)</span>
    test<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">'map'</span><span class="token punctuation">)</span>
    test<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">'map-async'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>


</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>运行时间对比

	num			normal		async		map			map-async
	
	1000		0.21s		0.11s		0.11s		0.11s
	10000		1.01s		0.41s		0.11s		0.11s
	100000		8.98s		4.15s		0.11s		0.11s
	1000000		90.5s		44.3s	0.32s		0.32s
</code></pre></div><h3 id="共享数据与同步"><a href="#共享数据与同步" class="header-anchor">#</a> 共享数据与同步</h3> <ul><li>在共享内存创建ctypes对象</li> <li>multiprocessing.Value(typecode,arg1,...,argn,lock)</li> <li>同value对象，但无锁</li> <li>multiprocessing.RawValue(typecode,arg1,...,argn)</li> <li>在共享内存中创造ctypes数组,initializer为指定数组初始大小的整数或项序列</li> <li>multiprocessing.Array(typecode,initializer,lock)</li> <li>同array对象，但无锁</li> <li>multiprocessing.RawArray(typecode,initializer)</li> <li>multiprocessing中还定义了一堆原语：
Lock，RLock，Semaphore，BoundedSemaphore，Event，Condition</li></ul> <h4 id="案例-共享队列-管道传输-共享内存的效率对比"><a href="#案例-共享队列-管道传输-共享内存的效率对比" class="header-anchor">#</a> 案例——共享队列，管道传输，共享内存的效率对比</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> multiprocessing <span class="token keyword">as</span> ml
<span class="token keyword">import</span> time



<span class="token keyword">def</span> <span class="token function">share_queue</span><span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span> transmit_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span>input_q<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
            item <span class="token operator">=</span> input_q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> item <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                input_q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token comment">#处理工作</span>
            input_q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">producer</span><span class="token punctuation">(</span>sequence<span class="token punctuation">,</span> output_q<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> sequence<span class="token punctuation">:</span>
            output_q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span>transmit_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#创建共享进程队列</span>
        q <span class="token operator">=</span> ml<span class="token punctuation">.</span>JoinableQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#运行消费者进程</span>
        con_p <span class="token operator">=</span> ml<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target <span class="token operator">=</span> consumer<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">(</span>q<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        con_p<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
        con_p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#生产多个项</span>
        sequence <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>transmit_size<span class="token punctuation">)</span><span class="token punctuation">]</span>
        producer<span class="token punctuation">(</span>sequence <span class="token operator">*</span> transmit_time<span class="token punctuation">,</span> q<span class="token punctuation">)</span>
        <span class="token comment">#在队列上安置哨兵，发出完成信号,若存在n个消费者进程，则要放n个哨兵</span>
        q<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>
        <span class="token comment">#等待项被处理,防止主程序被关闭后，消费被提前终止</span>
        q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
        end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'share_queue'</span><span class="token punctuation">,</span>transmit_size<span class="token punctuation">,</span><span class="token string">'time:'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token operator">/</span>transmit_time<span class="token punctuation">,</span><span class="token string">'s'</span><span class="token punctuation">)</span>


    test<span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span>transmit_size<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">share_memory</span><span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span>transmit_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">channel</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>maxsize<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span><span class="token builtin">buffer</span> <span class="token operator">=</span> ml<span class="token punctuation">.</span>RawArray<span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span>maxsize<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>buffer_len <span class="token operator">=</span> ml<span class="token punctuation">.</span>Value<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>empty <span class="token operator">=</span> ml<span class="token punctuation">.</span>Semaphore<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>full <span class="token operator">=</span> ml<span class="token punctuation">.</span>Semaphore<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>values<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>empty<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
            nitems <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>buffer_len <span class="token operator">=</span> nitems
            self<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token punctuation">:</span>nitems<span class="token punctuation">]</span> <span class="token operator">=</span> values
            self<span class="token punctuation">.</span>full<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">def</span> <span class="token function">recv</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>full<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
            values <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>buffer_len<span class="token punctuation">.</span>value<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>empty<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> values

    <span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span>ch<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>
            values <span class="token operator">=</span> ch<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">producer</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span>values<span class="token punctuation">,</span>ch<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>
            ch<span class="token punctuation">.</span>send<span class="token punctuation">(</span>values<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span> transmit_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        ch <span class="token operator">=</span> channel<span class="token punctuation">(</span>transmit_size<span class="token punctuation">)</span>
        p <span class="token operator">=</span> ml<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target <span class="token operator">=</span> consumer<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">)</span>
        p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>transmit_size<span class="token punctuation">)</span><span class="token punctuation">]</span>
        producer<span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span>values<span class="token punctuation">,</span>ch<span class="token punctuation">)</span>
        p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
        end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'share_memory'</span><span class="token punctuation">,</span>transmit_size<span class="token punctuation">,</span><span class="token string">'time:'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token operator">/</span>transmit_time<span class="token punctuation">,</span><span class="token string">'s'</span><span class="token punctuation">)</span>

    test<span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span>transmit_size<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">pipe</span><span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span>transmit_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span>pipe<span class="token punctuation">)</span><span class="token punctuation">:</span>
        output_p<span class="token punctuation">,</span>input_p <span class="token operator">=</span> pipe
        input_p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                item <span class="token operator">=</span> output_p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> EOFError<span class="token punctuation">:</span>
                <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">producer</span><span class="token punctuation">(</span>sequence<span class="token punctuation">,</span>input_p<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> sequence<span class="token punctuation">:</span>
            input_p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span>transmit_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        output_p<span class="token punctuation">,</span> input_p <span class="token operator">=</span> ml<span class="token punctuation">.</span>Pipe<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#启动消费者进程</span>
        cons_p <span class="token operator">=</span> ml<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target <span class="token operator">=</span> consumer<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>output_p<span class="token punctuation">,</span>input_p<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        cons_p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#关闭生产者中的输出管道</span>
        output_p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#生产项目</span>
        sequence <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>transmit_size<span class="token punctuation">)</span><span class="token punctuation">]</span>
        producer<span class="token punctuation">(</span>sequence <span class="token operator">*</span> transmit_time<span class="token punctuation">,</span> input_p<span class="token punctuation">)</span>
        <span class="token comment">#关闭输入管道，表示完成,不关则消费者一直循环</span>
        input_p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#等待使用者进程关闭</span>
        cons_p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
        end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'pipe'</span><span class="token punctuation">,</span>transmit_size<span class="token punctuation">,</span><span class="token string">'time:'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token operator">/</span>transmit_time<span class="token punctuation">,</span><span class="token string">'s'</span><span class="token punctuation">)</span>
    
    test<span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span>transmit_size<span class="token punctuation">)</span>

<span class="token comment">#传输次数</span>
transmit_time <span class="token operator">=</span> <span class="token number">10</span>
<span class="token comment">#单次传输大小</span>
sample <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">1000000</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> sample<span class="token punctuation">:</span>
    <span class="token comment">#共享队列方式</span>
    share_queue<span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    <span class="token comment">#共享内存方法</span>
    share_memory<span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    <span class="token comment">#管道传输方法</span>
    pipe<span class="token punctuation">(</span>transmit_time<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>运行结果对比：

传输大小	share_queue()		pipe()		share_memory()
10000	   0.309s			   0.076s			0.003s
100000	   3.247s			   0.756s			0.005s
1000000		过慢               7.612s			   0.043s
</code></pre></div><h3 id="托管对象"><a href="#托管对象" class="header-anchor">#</a> 托管对象</h3> <ul><li>对更高级的python对象，multiprocessing没有自带的共享对象，但可以使他们运行在管理器的控制下，实现共享效果</li> <li>管理器是独立的子进程，存在真实的对象，以服务器形式运行</li> <li>其他进程采用代理商访问共享对象，这些代理作为管理器服务器的客户端运行</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> multiprocessing <span class="token keyword">as</span> ml
<span class="token comment">#在进程中创建运行的管理器，返回值是SyncManager类型的实例</span>
m <span class="token operator">=</span> ml<span class="token punctuation">.</span>Manager<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
SyncManager类型的实例m具有一系列方法
'''</span>
<span class="token comment">#在服务器上创建共享的对象实例并返回可访问它的代理</span>
m<span class="token punctuation">.</span>Array<span class="token punctuation">(</span>typecode<span class="token punctuation">,</span>sequence<span class="token punctuation">)</span>
m<span class="token punctuation">.</span>BoundedSemaphore<span class="token punctuation">(</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>Condition<span class="token punctuation">(</span><span class="token punctuation">[</span>lock<span class="token punctuation">]</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">[</span>args<span class="token punctuation">]</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Sequence<span class="token punctuation">]</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>Namespace<span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>RLock<span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>Semaphore<span class="token punctuation">(</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>Value<span class="token punctuation">(</span>typecode<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
</code></pre></div><ul><li>对于更复杂类型的共享对象，如用户自定义的类，则必须创建自定义管理器对象，需要创建一个继承自BaseManager的类，并注册该数据类型</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> multiprocessing <span class="token keyword">as</span> ml
<span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager

<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> value
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'A (%s)'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>x
    <span class="token keyword">def</span> <span class="token function">getx</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>x
    <span class="token keyword">def</span> <span class="token function">setx</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> value
    <span class="token keyword">def</span> <span class="token function">__add__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">+=</span> value
        <span class="token keyword">return</span> self

<span class="token keyword">class</span> <span class="token class-name">MyManager</span><span class="token punctuation">(</span>BaseManager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

MyManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span>A<span class="token punctuation">)</span>

m <span class="token operator">=</span> MyManager<span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#创建托管对象</span>
a <span class="token operator">=</span> m<span class="token punctuation">.</span>A<span class="token punctuation">(</span><span class="token number">37</span><span class="token punctuation">)</span>

</code></pre></div><h4 id="案例-托管对象"><a href="#案例-托管对象" class="header-anchor">#</a> 案例——托管对象</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> multiprocessing <span class="token keyword">as</span> ml
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>evt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        evt<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
        evt<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

m <span class="token operator">=</span> ml<span class="token punctuation">.</span>Manager<span class="token punctuation">(</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
evt <span class="token operator">=</span> m<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#启动监视字典的进程</span>
p <span class="token operator">=</span> ml<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target<span class="token operator">=</span>watch<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>evt<span class="token punctuation">)</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#更新字典并通知监视者</span>
d<span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">42</span>
evt<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment">#终止进程和管理器</span>
p<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre></div><h3 id="连接"><a href="#连接" class="header-anchor">#</a> 连接</h3> <ul><li>若要求程序不仅能在一个机器上运行，还能扩展到一个计算集群上，可以使用multiprocessing.connection模块</li> <li>在mac上要先允许python.app能接入网络</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>connection <span class="token keyword">import</span> Listener
<span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>connection <span class="token keyword">import</span> Client
<span class="token keyword">import</span> multiprocessing <span class="token keyword">as</span> ml

<span class="token keyword">def</span> <span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    serv <span class="token operator">=</span> Listener<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>authkey<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        conn <span class="token operator">=</span> serv<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                x<span class="token punctuation">,</span>y <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> EOFError<span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            result <span class="token operator">=</span> x <span class="token operator">+</span> y
            conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    conn <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">,</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>authkey<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    r <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    r <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

server_p <span class="token operator">=</span> ml<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target<span class="token operator">=</span>listen<span class="token punctuation">)</span>
server_p<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
server_p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="注意事项及原则"><a href="#注意事项及原则" class="header-anchor">#</a> 注意事项及原则</h3> <ul><li><p>确保进程之间传递的所有数据能够序列化</p></li> <li><p>避免使用共享数据，尽量使用消息传递和队列</p></li> <li><p>在必须运行在单独进程的函数内部，不要使用全局变量，而应当显式传递参数</p></li> <li><p>显式关闭进程</p></li> <li><p>让事情变简单</p></li></ul> <h2 id="re"><a href="#re" class="header-anchor">#</a> re</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> re

<span class="token comment">#根据string的顺序找pattern，成功找到一个匹配pattern的，就是m.group()的值,若没找到pattern，返回的匹配对象m为None，关于m的一切方法都不存在</span>
<span class="token comment">#当m不是None值时，m.groups()的值是一个列表，有多少个分组括号，列表就对应有多少项，且顺序是基于左括号的</span>
pattern <span class="token operator">=</span> <span class="token string">'32(ab(?P&lt;cd&gt;c(?:d(e))))|f'</span>
string <span class="token operator">=</span> <span class="token string">'23a12abcdeff'</span>
</code></pre></div><h3 id="re-compile-函数"><a href="#re-compile-函数" class="header-anchor">#</a> re.compile()函数</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#编译一个正则对象，以后用pat直接调用match(),search(),findall(),finditer()函数，可省略pattern参数,flags参数re.I表示忽略大小写，re.M表示将^和$应用到整个字符串的开始和结尾的每一行，不仅是开头和结尾</span>
pat <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span>flags <span class="token operator">=</span> re<span class="token punctuation">.</span>I<span class="token punctuation">)</span>
</code></pre></div><h3 id="re-match-函数"><a href="#re-match-函数" class="header-anchor">#</a> re.match()函数</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#从字符串一开始匹配，若一开始就不对，则返回None</span>
mm <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span>string<span class="token punctuation">)</span>
</code></pre></div><h3 id="re-search-函数"><a href="#re-search-函数" class="header-anchor">#</a> re.search()函数</h3> <div class="language-python extra-class"><pre class="language-python"><code>m <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span>string<span class="token punctuation">)</span>
</code></pre></div><h3 id="re-findall-函数"><a href="#re-findall-函数" class="header-anchor">#</a> re.findall()函数</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#从字符串中找到所有匹配pattern的，返回一个列表，列表每一项是一个元组，元组元素相当于每个m.groups()中的元素</span>
lf <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span>string<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'lf'</span><span class="token punctuation">,</span>lf<span class="token punctuation">)</span>
</code></pre></div><h3 id="re-finditer-函数"><a href="#re-finditer-函数" class="header-anchor">#</a> re.finditer()函数</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#返回一个迭代器，迭代的是匹配对象m</span>
iterator <span class="token operator">=</span> re<span class="token punctuation">.</span>finditer<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span>string<span class="token punctuation">)</span>
<span class="token keyword">for</span> m <span class="token keyword">in</span> iterator<span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div><h3 id="match对象的用法"><a href="#match对象的用法" class="header-anchor">#</a> match对象的用法</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#以下属性，仅当匹配成功，m不为None时才存在，且下列属性都是基于匹配回来的东西去讨论，如此次匹配中的是第一个f，就不包含分组，所以分组为[None,None,None]</span>

<span class="token comment">#根据string的顺序找pattern，成功找到最先能匹配pattern的，就是m.group()的值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'m.group()'</span><span class="token punctuation">,</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#m.groups()的值是一个列表，有多少个分组括号，列表就对应有多少项，且顺序是基于左括号的，</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'m.groups()'</span><span class="token punctuation">,</span>m<span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#第2个分组在string中的起始位置，若省略参数，则选用m.group()在string中的起始位置</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'m.start(2)'</span><span class="token punctuation">,</span>m<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#第3个分组在string中的结束位置，若省略参数，则选用m.group()在string中的结束位置</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'m.end(3)'</span><span class="token punctuation">,</span>m<span class="token punctuation">.</span>end<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#第2个分组在string的起末位置的元组，若省略参数，则选用m.group()在string中的起末位置的元组</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'m.span()'</span><span class="token punctuation">,</span>m<span class="token punctuation">.</span>span<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#传递给search()或match()函数的pos值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'m.pos'</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
<span class="token comment">#传递给search()或match()函数的endpos值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'m.endpos'</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>endpos<span class="token punctuation">)</span>
<span class="token comment">#匹配对象所对应的正则对象</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'m.re'</span><span class="token punctuation">,</span>m<span class="token punctuation">.</span>re<span class="token punctuation">)</span>
<span class="token comment">#匹配对象所对应的输入字符串</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'m.string'</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>string<span class="token punctuation">)</span>
<span class="token comment">#返回标注了名称的分组的字典，key为组名，value为分组的字符串</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'m.groupdict()'</span><span class="token punctuation">,</span>m<span class="token punctuation">.</span>groupdict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="re-split-函数"><a href="#re-split-函数" class="header-anchor">#</a> re.split()函数</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#根据pattern出现的位置拆分string，返回字符串列表，包括pattern中任何分组匹配的文本</span>
ls <span class="token operator">=</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span>string<span class="token punctuation">)</span>
<span class="token comment"># 例子</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span> line
abc aa<span class="token punctuation">;</span>bb<span class="token punctuation">,</span>cc <span class="token operator">|</span> dd<span class="token punctuation">(</span>xx<span class="token punctuation">)</span><span class="token punctuation">.</span>xxx <span class="token number">12.12</span>'	xxxx
<span class="token comment"># 按空格切</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r' '</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token string">'aa;bb,cc'</span><span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">,</span> <span class="token string">'dd(xx).xxx'</span><span class="token punctuation">,</span> <span class="token string">&quot;12.12'\txxxx&quot;</span><span class="token punctuation">]</span>
<span class="token comment"># 加将空格放可选框内[]内</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'[ ]'</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token string">'aa;bb,cc'</span><span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">,</span> <span class="token string">'dd(xx).xxx'</span><span class="token punctuation">,</span> <span class="token string">&quot;12.12'\txxxx&quot;</span><span class="token punctuation">]</span>
<span class="token comment"># 按所有空白字符来切割：\s（[\t\n\r\f\v]）\S（任意非空白字符[^\t\n\r\f\v]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'[\s]'</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token string">'aa;bb,cc'</span><span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">,</span> <span class="token string">'dd(xx).xxx'</span><span class="token punctuation">,</span> <span class="token string">&quot;12.12'&quot;</span><span class="token punctuation">,</span> <span class="token string">'xxxx'</span><span class="token punctuation">]</span>
<span class="token comment"># 多字符匹配</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'[;,]'</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'abc aa'</span><span class="token punctuation">,</span> <span class="token string">'bb'</span><span class="token punctuation">,</span> <span class="token string">&quot;cc | dd(xx).xxx 12.12'\txxxx&quot;</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'[;,\s]'</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token string">'aa'</span><span class="token punctuation">,</span> <span class="token string">'bb'</span><span class="token punctuation">,</span> <span class="token string">'cc'</span><span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">,</span> <span class="token string">'dd(xx).xxx'</span><span class="token punctuation">,</span> <span class="token string">&quot;12.12'&quot;</span><span class="token punctuation">,</span> <span class="token string">'xxxx'</span><span class="token punctuation">]</span>
<span class="token comment"># 使用括号捕获分组的适合，默认保留分割符</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'([;])'</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'abc aa'</span><span class="token punctuation">,</span> <span class="token string">';'</span><span class="token punctuation">,</span> <span class="token string">&quot;bb,cc | dd(xx).xxx 12.12'\txxxx&quot;</span><span class="token punctuation">]</span>
<span class="token comment"># 去掉分隔符，加?:</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'(?:;)'</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'abc aa'</span><span class="token punctuation">,</span> <span class="token string">&quot;bb,cc | dd(xx).xxx 12.12'\txxxx&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="re-sub-用法"><a href="#re-sub-用法" class="header-anchor">#</a> re.sub()用法</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">deal</span><span class="token punctuation">(</span>matched<span class="token punctuation">)</span><span class="token punctuation">:</span>
    intStr<span class="token operator">=</span>matched<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span>
    intValue<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>intStr<span class="token punctuation">)</span>
    addValue<span class="token operator">=</span>intValue<span class="token operator">+</span><span class="token number">111</span>
    addValueStr<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span>addValue<span class="token punctuation">)</span>
    <span class="token keyword">return</span> addValueStr

inputStr<span class="token operator">=</span><span class="token string">&quot;hello 123 world 456&quot;</span>
replacedStr<span class="token operator">=</span>re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">&quot;hello 123 world 456&quot;</span><span class="token punctuation">,</span>deal<span class="token punctuation">,</span>inputStr<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>replacedStr<span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2/9/2022, 11:08:47 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepressBlog/techNote/engineering/Python/environment.html" class="prev">
        Python环境配置
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/vuepressBlog/assets/js/app.6b528729.js" defer></script><script src="/vuepressBlog/assets/js/2.ab72813d.js" defer></script><script src="/vuepressBlog/assets/js/112.0979c7a8.js" defer></script>
  </body>
</html>
